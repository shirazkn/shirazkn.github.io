<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Fourier Transforms of Periodic Functions | Shiraz</title>
<meta name="keywords" content="Harmonic Analysis">
<meta name="description" content="The Fourier transform takes a function and outputs a different (possibly complex-valued) function. We also have something called the Fourier series, which takes a periodic function and gives a summation rather than an integral. I want to derive the Fourier series using the Fourier transform for anyone who is interested in connecting the two concepts with each other.">
<meta name="author" content="">
<link rel="canonical" href="https://shirazkn.github.io/posts/fourier/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e150a9308943c96db7a04da2d3c2cfc65f8f6bdf60a8495e630a39fd37bfaf93.css" integrity="sha256-4VCpMIlDyW23oE2i08LPxl&#43;Pa99gqEleYwo5/Te/r5M=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://shirazkn.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://shirazkn.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://shirazkn.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://shirazkn.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://shirazkn.github.io/favicon.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://shirazkn.github.io/posts/fourier/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><script>
(function() {
    var pref = localStorage.getItem("pref-theme");
    if (pref === "dark" || (!pref && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
        document.documentElement.classList.add("dark");
    }
})();
</script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      packages: {'[+]': ['mathtools', 'amscd']},
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']]  
    },
    loader:{
      load: ['ui/safe', '[tex]/mathtools', '[tex]/amscd']
    },
  };
</script>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IM+Fell+DW+Pica">

<meta property="og:url" content="https://shirazkn.github.io/posts/fourier/">
  <meta property="og:site_name" content="Shiraz">
  <meta property="og:title" content="Fourier Transforms of Periodic Functions">
  <meta property="og:description" content="The Fourier transform takes a function and outputs a different (possibly complex-valued) function. We also have something called the Fourier series, which takes a periodic function and gives a summation rather than an integral. I want to derive the Fourier series using the Fourier transform for anyone who is interested in connecting the two concepts with each other.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-10-02T14:59:15-04:00">
    <meta property="article:modified_time" content="2023-10-02T14:59:15-04:00">
    <meta property="article:tag" content="Harmonic Analysis">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fourier Transforms of Periodic Functions">
<meta name="twitter:description" content="The Fourier transform takes a function and outputs a different (possibly complex-valued) function. We also have something called the Fourier series, which takes a periodic function and gives a summation rather than an integral. I want to derive the Fourier series using the Fourier transform for anyone who is interested in connecting the two concepts with each other.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://shirazkn.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Fourier Transforms of Periodic Functions",
      "item": "https://shirazkn.github.io/posts/fourier/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Fourier Transforms of Periodic Functions",
  "name": "Fourier Transforms of Periodic Functions",
  "description": "The Fourier transform takes a function and outputs a different (possibly complex-valued) function. We also have something called the Fourier series, which takes a periodic function and gives a summation rather than an integral. I want to derive the Fourier series using the Fourier transform for anyone who is interested in connecting the two concepts with each other.",
  "keywords": [
    "Harmonic Analysis"
  ],
  "articleBody": "The Fourier transform takes a (absolutely integrable) function $f:\\mathbb R \\rightarrow \\mathbb R$ and outputs a different (possibly complex-valued) function. If the first is interpreted as a signal (e.g., the waveform of an audio that is parameterized by time), then its Fourier transform has its ‘peaks’ at the dominant frequencies of the signal. I will not expound too much on the Fourier transform itself, but its computation looks something like this1:\n$$ \\mathcal F [f](\\omega) \\coloneqq \\int_{-\\infty}^\\infty f(t) e^{-i \\omega t} dt $$which we will also write as $\\hat f(\\omega) \\coloneqq \\mathcal F [f](\\omega)$. Here’s what the Fourier transform of a rectangular ‘pulse’ signal looks like; the one on the right is called as the $\\textrm{sinc}$ function:\nOn the other hand, we also have something called the Fourier series, which takes a periodic function $f$ and gives a summation rather than an integral. Let me not present the formula for the Fourier series right away. Instead, I want to derive it using the Fourier transform for anyone who is interested in connecting the two concepts with each other.2 We will also avoid any of the pathologies related to distributions (which is why Wikipedia hesitates to say much on the matter).\nPeriodic Functions Given a periodic function $\\tilde f(t)$ having a period $T\u003e0$, i.e.,\n$\\dots =\\tilde f(t-T) = $$\\tilde f(t)$ $=\\tilde f(t+T)=\\tilde f(t+2T)=\\dots$, we can always re-parameterize it as $f(t)\\coloneqq \\tilde f(\\frac{T}{2 \\pi} t)$, so that $f$ has a period of $2\\pi$. Hence, we typically bring functions to this ‘standard form’ before taking the Fourier transform, causing the period $T$ to disappear from the Fourier transform formulas and properties.\nAnother way of viewing a $2\\pi$-periodic function is as a mapping $f:\\mathbb R/2\\pi \\mathbb Z\\rightarrow \\mathbb R$. The object $\\mathbb R/2\\pi \\mathbb Z$ is called a quotient group ; it is the object you get when you take $\\mathbb R$ and ‘glue’ $0$ to $2\\pi$ such that it forms a circle. It’s easy to see why a function ‘defined on a circle’ can be interpreted as a periodic function. The theory of Pontryagin duality extends the Fourier transform to the domain $\\mathbb R/2\\pi \\mathbb Z$ (which gives us the Fourier series), as well as to other domains of interest like the integers and their quotient groups (which give us the discrete-time Fourier transforms of aperiodic and periodic signals, respectively).\nNevertheless, in what follows, we will treat $f$ as a periodic function whose domain is $\\mathbb R$.\nFourier Series Given a set of numbers $\\lbrace c_k\\rbrace _{k\\in\\mathbb Z}$, $c_k\\in \\mathbb C$, the following is a $2\\pi$-periodic function:\n$$f(t) \\coloneqq \\sum_{k=-\\infty}^{\\infty}c_k \\hspace{2pt}e^{i kt} $$since $e^{i kt} = e^{i k(t+2\\pi)}$ whenever $k\\in \\mathbb Z$. In fact, any $2\\pi$-periodic function (and by extension, any $T$-periodic function which is square-integrable ) can be expressed in the form shown above, which is called as its Fourier series representation. Take a second to observe how remarkable this is; at first, it appears as if in order to specify an arbitrary real-valued periodic function $f(\\cdot)$, we would need to specify uncountably many real numbers, $\\lbrace f(t) \\rbrace_{t\\in\\mathbb R}$. But the Fourier series representation says that only countably many real numbers are needed to specify $f(\\cdot)$, namely3\n$$\\Big\\lbrace \\textrm{Re}(c_k), \\textrm{Im}(c_k) \\Big\\rbrace_{k\\in\\mathbb Z}.$$If you’re anything like me, you might think that the Fourier series representation should arise as a special case of the Fourier transform. After all, periodic functions are just ordinary functions that satisfy an additional (rather special) property. Well… almost! For the Fourier transform to exist, the function in question should be absolutely integrable (i.e., $|f(t)|$ should integrate to a finite value), but this is clearly not the case when $f(t)$ is periodic and takes non-zero values.\nFourier Transform $\\rightarrow$ Fourier Series Let $f(t)$ be a $2\\pi$-periodic function. We want to make sense of what its Fourier transform (if it were well-defined) would even look like. Ultimately, we hope that it will coincide with its Fourier series representation in some sense. It would be absolutely horrifying if they turned out to be two completely unrelated concepts. Thankfully, we will see that\n$$``\\mathcal F^{-1}\\Big[\\mathcal F\\big[ f\\big]\\Big] (t)\"$$does end up looking like a Fourier series representation of $f$ (where we used the quotes to remind ourselves that the usual Fourier and inverse Fourier transforms aren’t defined when $f(t)$ has a finite period). In fact, it will turn out that $\\mathcal F[f](\\omega)$ has the following form4:\nThe plot on the right looks somewhat like a Dirac comb , which is an evenly spaced ‘comb’ or a ’train’ of Dirac delta functions, whose spacing corresponds to the ’natural frequency’ of the signal.\nApproach #1: There’s multiple ways of doing this. A very mechanical way of getting from the Fourier transform to the Fourier series is by approximating the original function with one that is absolutely integrable, as follows:\n\\[ \\begin{align*} \\hat f_0(\\omega) \u0026= \\lim_{\\epsilon \\rightarrow 0} \\mathcal F \\big[ f(t) e^{-\\epsilon t^2} \\big] \\\\ \u0026= \\lim_{\\epsilon \\rightarrow 0} \\int_{-\\infty}^\\infty f(t) e^{-\\epsilon t^2} e^{-i\\omega t} dt \\end{align*} \\] where the $e^{-\\epsilon t^2}$ term tapers off the plot of $f(t)$ in either direction ($t\\rightarrow \\infty$ and $t\\rightarrow -\\infty$), making the function absolutely integrable. As $\\epsilon \\rightarrow 0$, the factor $e^{-\\epsilon t^2}$ disappears, and we should recover the Fourier series representation of $f(t)$ by expressing it as $\\mathcal F^{-1}\\big[ \\hat f_0 \\big] (t)$. In fact, as $e^{-\\epsilon t^2}$ disappears, the function becomes truly periodic, and its Fourier transform tends towards non-existence. This coincides with the appearance of the Dirac delta functions in the Fourier domain, which are technically not functions, but distributions .\nApproach #2: We can also use the Fourier transform tables and their properties to do this. These tables and properties (which are easily found through a quick Google search) ignore the intricacies related to distributions (in particular, the Dirac delta function) and that’s what we’ll do too. So in the true spirit of engineering, let’s assume that $\\hat f(\\omega)\\coloneqq\\mathcal F\\big[f\\big](\\omega)$ is well defined. We have,\n$$ \\hat f(\\omega) = \\int_{-\\infty}^\\infty f(\\tau) e^{-i\\omega \\tau} d\\tau, $$where we use the notation ‘$\\tau$’ to prevent its confusion with the variable $t$ used below. Due to the periodicity of $f(t)$, we can decompose this as\n$$ \\hat f(\\omega) = \\sum_{k=-\\infty}^{\\infty}\\int_{0}^{2\\pi} f(\\tau) e^{-i\\omega (2\\pi k + \\tau)} d\\tau, $$Good, now we have the ‘summation’ we need for the Fourier series. Since $f(t) = \\mathcal F^{-1}\\big[\\hat f \\hspace{1pt}\\big] (t) $, we can write\n$$ f(t) = \\frac{1}{2\\pi} \\int_{-\\infty}^\\infty \\left[\\sum_{k=-\\infty}^{\\infty}\\int_{0}^{2\\pi} f(\\tau) e^{-i\\omega (2\\pi k + \\tau)} d\\tau \\right] e^{i\\omega t}d\\omega $$where the factor $1/2\\pi$ is a standard feature of Fourier analysis; it shows up when we do $\\mathcal F^{-1}\\big[\\mathcal F[\\ \\cdot\\ ]\\big]$. Since we’re both engineers, we will swap the integrals and summation around (in actuality, we need to check certain convergence and ‘regularity’ conditions before doing this):\n\\[ \\begin{align*} f(t) \u0026= \\sum_{k=-\\infty}^{\\infty}\\int_{0}^{2\\pi} f(\\tau) \\left[ \\frac{1}{2\\pi} \\int_{-\\infty}^\\infty e^{-i\\omega (2\\pi k + \\tau)} e^{i\\omega t} d\\omega \\right] d\\tau\\\\ \\end{align*} \\] Focusing on the term inside the ‘$[\\ \\cdot\\ ]$’, and letting $a \\coloneqq 2\\pi k + \\tau$, we have\n$$ \\frac{1}{2\\pi} \\int_{-\\infty}^\\infty e^{-i\\omega a} e^{i\\omega t} d\\omega $$Notice that this is the inverse Fourier transform of some function whose Fourier transform is $e^{-i\\omega a}$. Here’s where we use the Fourier transform table as well as the “time-shift” property of Fourier transform pairs to see that\n$$ \\frac{1}{2\\pi}\\int_{-\\infty}^\\infty e^{-i\\omega a} e^{i\\omega t} d\\omega = \\delta (t - a) = \\delta(t - \\tau - 2 \\pi k) $$Plugging this back in,\n\\[ \\begin{align*} f(t) \u0026= \\sum_{k=-\\infty}^{\\infty}\\int_{0}^{2\\pi} f(\\tau) \\delta(t - \\tau - 2 \\pi k) d\\tau\\\\ \u0026= \\sum_{k=-\\infty}^{\\infty}\\int_{0}^{2\\pi} f(\\tau) \\delta\\big(\\tau - (t - 2 \\pi k) \\big) d\\tau \\\\ \u0026= \\int_{0}^{2\\pi} f(\\tau) \\sum_{k=-\\infty}^{\\infty}\\Big[\\delta\\big(\\tau - (t - 2 \\pi k) \\big)\\Big] d\\tau \\end{align*} \\] For any value of $t$ chosen on the left hand side, there exists a $k_0\\in \\mathbb Z$ such that\n\\[ \\begin{align*} f(t) \u0026= \\int_{0}^{2\\pi} f(\\tau) \\delta\\big(\\tau - (t - 2 \\pi k_0) \\big) d\\tau\\\\ \u0026= f(t - 2 \\pi k_0) = f(t) \\end{align*} \\] This is because $\\sum_{k=-\\infty}^{\\infty}\\delta\\big(\\tau - (t - 2 \\pi k) \\big)$ is a ‘comb’ of Dirac delta functions that are spaced $2\\pi$ apart from each other, so that only one of these Dirac deltas is picked out by the integral $\\int_0^{2\\pi} \\star\\ d\\tau$.\nBut wait a second! We went around in a circle (pun intended) to show that $f(t) = \\mathcal F^{-1}\\Big[\\mathcal F[f] \\Big](t)$. Well, at least now we know that the calculation that we did above checks out, even though we are scarcely able to define $\\mathcal F[f] (\\omega)$ and despite the fact that we swapped summations and integrals around like it’s nothing!\nApproach #2 (Revisited): Let’s go back to the equation\n\\[ \\begin{align*} f(t) \u0026= \\int_{0}^{2\\pi} f(\\tau) \\sum_{k=-\\infty}^{\\infty}\\Big[\\delta\\big(\\tau - (t - 2 \\pi k) \\big)\\Big] d\\tau \\end{align*} \\] and use the Poisson summation formula (for now, we think of it as a magic trick), which allows us to say that\n$$ 2 \\pi \\sum_{k=-\\infty}^\\infty \\delta (\\tilde \\tau + 2 \\pi k) = \\sum_{k=-\\infty}^\\infty e^{-ik\\tilde \\tau} $$We will unpack this strange result shortly; for now, let’s apply it to our expression above (with $\\tilde \\tau=\\tau - t$)\n\\[ \\begin{align*} f(t) \u0026= \\frac{1}{2\\pi} \\int_{0}^{2\\pi} f(\\tau) \\sum_{k=-\\infty}^{\\infty}e^{-ik(\\tau - t)} d\\tau\\\\ \u0026= \\sum_{k=-\\infty}^{\\infty} \\left[\\frac{1}{2\\pi} \\int_{0}^{2\\pi} f(\\tau) e^{-ik\\tau} d\\tau \\right] e^{ikt} \\end{align*} \\] which is just the Fourier series representation of $f(t)$, with the coefficients $c_k$ equated to the integral inside $\\left[\\ \\cdot\\ \\right]$. Thus, the bridge between the Fourier transfrom and the Fourier series hinges on the Poisson summation formula.\nThe Poisson Summation Formula So why did we need to rely on this strange result, that\n$$ 2 \\pi \\sum_{k=-\\infty}^\\infty \\delta (\\tilde \\tau + 2 \\pi k) = \\sum_{k=-\\infty}^\\infty e^{-ik\\tilde \\tau}\\ \\qquad (*) $$to show that the Fourier transform resolves to the Fourier series in the case of a periodic function? Observe that the function $\\sum_{k=-\\infty}^\\infty\\delta (\\tilde \\tau + 2 \\pi k)$ is a Dirac comb , which is a series of ’needles’ (Dirac delta functions) spaced apart by a distance of $2\\pi$. Its Fourier transform is also a Dirac comb (see this blog post ; another way to see this is to consider the Dirac comb as a sampled/‘discrete-time’ periodic signal whose discrete-time Fourier transform is being sought). Equating $\\sum_{k=-\\infty}^\\infty\\delta (\\tilde \\tau + 2 \\pi k)$ to its corresponding inverse Fourier transform gives us $(*)$. The inverse Fourier transform integrates over the Dirac comb, and the comb turns the integral into a summation.\nEquation $(*)$ is a special case of the Poisson summation formula (which is in turn a special case of the convolution theorem ) applied to the Dirac comb. Proofs of the summation formula can be found on its Wikipedia page , though I haven’t looked at it hard enough to see if there’s an intuitive explanation of it that warrants repeating here. We could always prove $(*)$ using Approach #1 outlined above.\nUltimately, we have only swept the problem under the rug. We still don’t understand how to re-discover the Fourier series using the Fourier transform, except by working through $(*)$ first. At least this appears to be a less formidable challenge, one that I might have more to say about in the future. I suspect that a complete theory of the relationships between the various types of Fourier analyses is given by Pontryagin duality , although a more immediate and accessible explanation of it would be nice.\nUnfortunately, there are at least six different conventions for how the Fourier transform and its inverse are defined. We place the factor of $1/2\\pi$ on the inverse Fourier transform, and we assume the function to be $2\\pi$-periodic. The same convention is followed here . ↩︎\nBy the way, it is also possible to derive the Fourier transform from the Fourier series using a Riemann sum , by letting the ‘period’ of a ‘periodic function’ tend to $+\\infty$. This is probably more intuitive to work through, since we’ve already seen this sort of a calculation in introductory calculus classes. ↩︎\nHere's a more general fact, of which this is a special case. ↩︎\nThis is not an actual Fourier transform pair, just an illustration. ↩︎\n",
  "wordCount" : "1992",
  "inLanguage": "en",
  "datePublished": "2023-10-02T14:59:15-04:00",
  "dateModified": "2023-10-02T14:59:15-04:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://shirazkn.github.io/posts/fourier/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Shiraz",
    "logo": {
      "@type": "ImageObject",
      "url": "https://shirazkn.github.io/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://shirazkn.github.io/" accesskey="h" title="Shiraz (Alt + H)">Shiraz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://shirazkn.github.io/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="https://shirazkn.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://shirazkn.github.io/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Fourier Transforms of Periodic Functions
    </h1>
    <div class="post-meta"><span title='2023-10-02 14:59:15 -0400 EDT'>October 2, 2023</span>

</div>
  </header> 
  <div class="post-content"><p>The <span class=accented>Fourier transform </span>takes a (absolutely integrable) function $f:\mathbb R \rightarrow \mathbb R$ and outputs a different (possibly complex-valued) function. If the first is interpreted as a <em>signal</em> (e.g., the waveform of an audio that is parameterized by time), then its Fourier transform has its &lsquo;peaks&rsquo; at the dominant frequencies of the signal. I will not expound too much on the Fourier transform itself, but its computation looks something like this<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>:</p>
$$
\mathcal F [f](\omega) \coloneqq \int_{-\infty}^\infty f(t) e^{-i \omega t} dt
$$<p>which we will also write as $\hat f(\omega) \coloneqq \mathcal F [f](\omega)$. Here&rsquo;s what the Fourier transform of a rectangular &lsquo;pulse&rsquo; signal looks like; the one on the right is called as the $\textrm{sinc}$ function:</p>
<div>
<figure class=invertible style="max-width: 100%;">
<img src=/post-images/fourier/rect.png>
</figure>
</div>
<p>On the other hand, we also have something called the <span class=accented>Fourier series</span>, which takes a periodic function $f$ and gives a summation rather than an integral. Let me not present the formula for the Fourier series right away. Instead, I want to derive it using the Fourier transform for anyone who is interested in connecting the two concepts with each other.<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> We will also avoid any of the pathologies related to <a href="https://en.wikipedia.org/wiki/Distribution_%28mathematics%29" target="_blank" class="accented">
    distributions
</a> (which is why Wikipedia hesitates to say much on the matter).</p>
<!-- ### Overview -->
<h3 id="periodic-functions">Periodic Functions<a hidden class="anchor" aria-hidden="true" href="#periodic-functions">#</a></h3>
<p>Given a periodic function $\tilde f(t)$ having a period $T>0$, i.e.,</p>
<p class=centred>
$\dots =\tilde f(t-T) = $<span class=accented>$\tilde f(t)$ </span>$=\tilde f(t+T)=\tilde f(t+2T)=\dots$,
</p>
<p>we can always re-parameterize it as $f(t)\coloneqq \tilde f(\frac{T}{2 \pi} t)$, so that $f$ has a period of $2\pi$. Hence, we typically bring functions to this &lsquo;standard form&rsquo; before taking the Fourier transform, causing the period $T$ to disappear from the Fourier transform formulas and properties.</p>
<p>Another way of viewing a $2\pi$-periodic function is as a mapping $f:\mathbb R/2\pi \mathbb Z\rightarrow \mathbb R$. The object $\mathbb R/2\pi \mathbb Z$ is called a <a href="https://en.wikipedia.org/wiki/Quotient_group" target="_blank" class="accented">
    quotient group
</a>; it is the object you get when you take $\mathbb R$ and &lsquo;glue&rsquo; $0$ to $2\pi$ such that it forms a circle. It&rsquo;s easy to see why a function &lsquo;defined on a circle&rsquo; can be interpreted as a periodic function. The theory of <a href="https://en.wikipedia.org/wiki/Pontryagin_duality" target="_blank" class="accented">
    Pontryagin duality
</a> extends the Fourier transform to the domain $\mathbb R/2\pi \mathbb Z$ (which gives us the Fourier series), as well as to other domains of interest like the integers and their quotient groups (which give us the discrete-time Fourier transforms of aperiodic and periodic signals, respectively).</p>
<p>Nevertheless, in what follows, we will treat $f$ as a periodic function whose domain is $\mathbb R$.</p>
<h3 id="fourier-series">Fourier Series<a hidden class="anchor" aria-hidden="true" href="#fourier-series">#</a></h3>
<p>Given a set of numbers $\lbrace c_k\rbrace _{k\in\mathbb Z}$, $c_k\in \mathbb C$, the following is a $2\pi$-periodic function:</p>
$$f(t) \coloneqq \sum_{k=-\infty}^{\infty}c_k \hspace{2pt}e^{i kt}
$$<p>since $e^{i kt} = e^{i k(t+2\pi)}$ whenever $k\in \mathbb Z$.
In fact, <em>any</em> $2\pi$-periodic function (and by extension, any $T$-periodic function which is <a href="/posts/hilbert-spaces" class="accented">
    square-integrable
</a>) can be expressed in the form shown above, which is called as its <span class=accented>Fourier series representation</span>. Take a second to observe how remarkable this is; at first, it appears as if in order to specify an arbitrary real-valued periodic function $f(\cdot)$, we would need to specify uncountably many real numbers, $\lbrace f(t) \rbrace_{t\in\mathbb R}$. But the Fourier series representation says that only countably many real numbers are needed to specify $f(\cdot)$, namely<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
$$\Big\lbrace \textrm{Re}(c_k), \textrm{Im}(c_k) \Big\rbrace_{k\in\mathbb Z}.$$<p>If you&rsquo;re anything like me, you might think that the Fourier series representation should arise as a special case of the Fourier transform. After all, periodic functions are just ordinary functions that satisfy an additional (rather special) property. Well&hellip; <span class=accented>almost!</span> For the Fourier transform to exist, the function in question should be absolutely integrable (i.e., $|f(t)|$ should integrate to a finite value), but this is clearly not the case when $f(t)$ is periodic and takes non-zero values.</p>
<hr>
<h3 id="fourier-transform--fourier-series">Fourier Transform $\rightarrow$ Fourier Series<a hidden class="anchor" aria-hidden="true" href="#fourier-transform--fourier-series">#</a></h3>
<p>Let $f(t)$ be a $2\pi$-periodic function. We want to make sense of what its Fourier transform (if it were well-defined) would even look like. Ultimately, we hope that it will coincide with its Fourier series representation in some sense. It would be absolutely horrifying if they turned out to be two completely unrelated concepts. Thankfully, we will see that</p>
$$``\mathcal F^{-1}\Big[\mathcal F\big[ f\big]\Big] (t)"$$<p>does end up looking like a Fourier series representation of $f$ (where we used the quotes to remind ourselves that the usual Fourier and inverse Fourier transforms aren&rsquo;t defined when $f(t)$ has a finite period). In fact, it will turn out that $\mathcal F[f](\omega)$ has the following form<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>:</p>
<div>
<figure class=invertible style="max-width: 100%;">
<img src=/post-images/fourier/periodic.png>
</figure>
</div>
<p>The plot on the right looks somewhat like a <a href="https://en.wikipedia.org/wiki/Dirac_comb" target="_blank" class="accented">
    Dirac comb
</a>, which is an evenly spaced &lsquo;comb&rsquo; or a &rsquo;train&rsquo; of Dirac delta functions, whose spacing corresponds to the &rsquo;natural frequency&rsquo; of the signal.</p>
<h4 id="approach-1">Approach #1:<a hidden class="anchor" aria-hidden="true" href="#approach-1">#</a></h4>
<p>There&rsquo;s multiple ways of doing this. A very mechanical way of getting from the Fourier transform to the Fourier series is by approximating the original function with one that <em>is</em> absolutely integrable, as follows:</p>
<p>
\[
    \begin{align*}
\hat f_0(\omega) &= \lim_{\epsilon \rightarrow 0} \mathcal F \big[ f(t) e^{-\epsilon t^2} \big] \\
&= \lim_{\epsilon \rightarrow 0} \int_{-\infty}^\infty f(t) e^{-\epsilon t^2} e^{-i\omega t} dt
    \end{align*}
\]
</p>
<p>where the $e^{-\epsilon t^2}$ term tapers off the plot of $f(t)$ in either direction ($t\rightarrow \infty$ and $t\rightarrow -\infty$), making the function absolutely integrable. As $\epsilon \rightarrow 0$, the factor $e^{-\epsilon t^2}$ disappears, and we should recover the Fourier series representation of $f(t)$ by expressing it as $\mathcal F^{-1}\big[ \hat f_0 \big] (t)$. In fact, as $e^{-\epsilon t^2}$ disappears, the function becomes truly periodic, and its Fourier transform tends towards non-existence. This coincides with the appearance of the Dirac delta functions in the Fourier domain, which are technically not functions, but <a href="https://en.wikipedia.org/wiki/Distribution_%28mathematics%29" target="_blank" class="accented">
    distributions
</a>.</p>
<h4 id="approach-2">Approach #2:<a hidden class="anchor" aria-hidden="true" href="#approach-2">#</a></h4>
<p>We can also use the <a href="https://engineering.purdue.edu/~mikedz/ee301/FourierTransformTable.pdf" target="_blank" class="accented">
    Fourier transform tables
</a> and their properties to do this. These tables and properties (which are easily found through a quick Google search) ignore the intricacies related to distributions (in particular, the Dirac delta function) and that&rsquo;s what we&rsquo;ll do too. So in the true spirit of engineering, let&rsquo;s assume that $\hat f(\omega)\coloneqq\mathcal F\big[f\big](\omega)$ is well defined. We have,</p>
$$
\hat f(\omega) = \int_{-\infty}^\infty f(\tau) e^{-i\omega \tau} d\tau,
$$<p>where we use the notation &lsquo;$\tau$&rsquo; to prevent its confusion with the variable $t$ used below. Due to the periodicity of $f(t)$, we can decompose this as</p>
$$
\hat f(\omega) = \sum_{k=-\infty}^{\infty}\int_{0}^{2\pi} f(\tau) e^{-i\omega (2\pi k + \tau)} d\tau,
$$<p>Good, now we have the &lsquo;summation&rsquo; we need for the Fourier series. Since $f(t) = \mathcal F^{-1}\big[\hat f \hspace{1pt}\big]  (t) $, we can write</p>
$$
f(t) = \frac{1}{2\pi} \int_{-\infty}^\infty \left[\sum_{k=-\infty}^{\infty}\int_{0}^{2\pi} f(\tau) e^{-i\omega (2\pi k + \tau)} d\tau \right] e^{i\omega t}d\omega
$$<p>where the factor $1/2\pi$ is a standard feature of Fourier analysis; it shows up when we do $\mathcal F^{-1}\big[\mathcal F[\ \cdot\ ]\big]$.
Since we&rsquo;re both engineers, we will swap the integrals and summation around (in actuality, we need to check certain convergence and &lsquo;regularity&rsquo; conditions before doing this):</p>
<p>
\[
    \begin{align*}
f(t) &= \sum_{k=-\infty}^{\infty}\int_{0}^{2\pi} f(\tau) \left[ \frac{1}{2\pi} \int_{-\infty}^\infty  e^{-i\omega (2\pi k + \tau)} e^{i\omega t} d\omega  \right] d\tau\\
    \end{align*}
\]
</p>
<p>Focusing on the term inside the &lsquo;$[\ \cdot\ ]$&rsquo;, and letting $a \coloneqq 2\pi k + \tau$, we have</p>
$$
\frac{1}{2\pi} \int_{-\infty}^\infty  e^{-i\omega a} e^{i\omega t} d\omega 
$$<p>Notice that this is the <span class=accented>inverse Fourier transform</span> of some function whose Fourier transform is $e^{-i\omega a}$. Here&rsquo;s where we use the Fourier transform table as well as the &ldquo;time-shift&rdquo; property of Fourier transform pairs to see that</p>
$$
\frac{1}{2\pi}\int_{-\infty}^\infty  e^{-i\omega a} e^{i\omega t} d\omega = \delta (t - a) = \delta(t - \tau - 2 \pi k)
$$<p>Plugging this back in,</p>
<p>
\[
    \begin{align*}
f(t) &= \sum_{k=-\infty}^{\infty}\int_{0}^{2\pi} f(\tau) \delta(t - \tau - 2 \pi k) d\tau\\
&=  \sum_{k=-\infty}^{\infty}\int_{0}^{2\pi} f(\tau) \delta\big(\tau - (t - 2 \pi k) \big) d\tau \\
&=  \int_{0}^{2\pi} f(\tau) \sum_{k=-\infty}^{\infty}\Big[\delta\big(\tau - (t - 2 \pi k) \big)\Big] d\tau
 \end{align*}
\]
</p>
<p>For any value of $t$ chosen on the left hand side, there exists a $k_0\in \mathbb Z$ such that</p>
<p>
\[
    \begin{align*}
f(t) &=  \int_{0}^{2\pi} f(\tau) \delta\big(\tau - (t - 2 \pi k_0) \big) d\tau\\
&= f(t - 2 \pi k_0) = f(t)
 \end{align*}
\]
</p>
<p>This is because $\sum_{k=-\infty}^{\infty}\delta\big(\tau - (t - 2 \pi k) \big)$ is a &lsquo;comb&rsquo; of Dirac delta functions that are spaced $2\pi$ apart from each other, so that only one of these Dirac deltas is picked out by the integral $\int_0^{2\pi} \star\ d\tau$.</p>
<p>But wait a second! We went around in a circle (pun intended) to show that $f(t) = \mathcal F^{-1}\Big[\mathcal F[f] \Big](t)$. Well, at least now we know that the calculation that we did above checks out, even though we are scarcely able to define $\mathcal F[f] (\omega)$ and despite the fact that we swapped summations and integrals around like it&rsquo;s nothing!</p>
<h4 id="approach-2-revisited">Approach #2 (Revisited):<a hidden class="anchor" aria-hidden="true" href="#approach-2-revisited">#</a></h4>
<!-- In the math we did above, we used the fact that $\mathcal F\[\delta(t)\](\omega) = 1$. We combined this with the so-called "time-shift" property to conclude that $\mathcal F\[\delta(t-a)\](\omega) = e^{-i\omega a}$. -->
<p>Let&rsquo;s go back to the equation</p>
<p>
\[
    \begin{align*}
f(t) &= \int_{0}^{2\pi} f(\tau) \sum_{k=-\infty}^{\infty}\Big[\delta\big(\tau - (t - 2 \pi k) \big)\Big] d\tau
 \end{align*}
\]
</p>
<p>and use the <a href="https://en.wikipedia.org/wiki/Poisson_summation_formula" target="_blank" class="accented">
    Poisson summation formula
</a> (for now, we think of it as a magic trick), which allows us to say that</p>
$$
2 \pi \sum_{k=-\infty}^\infty \delta (\tilde \tau + 2 \pi k) = \sum_{k=-\infty}^\infty e^{-ik\tilde \tau}
$$<p>We will unpack this strange result shortly; for now, let&rsquo;s apply it to our expression above (with $\tilde \tau=\tau - t$)</p>
<p>
\[
    \begin{align*}
f(t) &= \frac{1}{2\pi} \int_{0}^{2\pi} f(\tau) \sum_{k=-\infty}^{\infty}e^{-ik(\tau - t)} d\tau\\
&= \sum_{k=-\infty}^{\infty} \left[\frac{1}{2\pi} \int_{0}^{2\pi} f(\tau) e^{-ik\tau} d\tau \right] e^{ikt}
 \end{align*}
\]
</p>
<p>which is just the Fourier series representation of $f(t)$, with the coefficients $c_k$ equated to the integral inside $\left[\ \cdot\ \right]$. Thus, the bridge between the Fourier transfrom and the Fourier series hinges on the Poisson summation formula.</p>
<h3 id="the-poisson-summation-formula">The Poisson Summation Formula<a hidden class="anchor" aria-hidden="true" href="#the-poisson-summation-formula">#</a></h3>
<p>So why did we need to rely on this strange result, that</p>
$$
2 \pi \sum_{k=-\infty}^\infty \delta (\tilde \tau + 2 \pi k) = \sum_{k=-\infty}^\infty e^{-ik\tilde \tau}\ \qquad (*)
$$<p>to show that the Fourier transform resolves to the Fourier series in the case of a periodic function? Observe that the function $\sum_{k=-\infty}^\infty\delta (\tilde \tau + 2 \pi k)$ is a <a href="https://en.wikipedia.org/wiki/Dirac_comb" target="_blank" class="accented">
    Dirac comb
</a>, which is a series of &rsquo;needles&rsquo; (Dirac delta functions) spaced apart by a distance of $2\pi$. Its Fourier transform is also a Dirac comb (see <a href="https://dspillustrations.com/pages/posts/misc/the-dirac-comb-and-its-fourier-transform.html" target="_blank" class="accented">
    this blog post
</a>; another way to see this is to consider the Dirac comb as a sampled/&lsquo;discrete-time&rsquo; periodic signal whose <a href="https://en.wikipedia.org/wiki/Discrete-time_Fourier_transform#Periodic_data" target="_blank" class="accented">
    discrete-time Fourier transform
</a> is being sought). Equating $\sum_{k=-\infty}^\infty\delta (\tilde \tau + 2 \pi k)$ to its corresponding inverse Fourier transform gives us $(*)$. The inverse Fourier transform integrates over the Dirac comb, and the comb turns the integral into a summation.</p>
<p>Equation $(*)$ is a special case of the Poisson summation formula (which is in turn a special case of the <a href="https://en.wikipedia.org/wiki/Convolution_theorem" target="_blank" class="accented">
    convolution theorem
</a>) applied to the Dirac comb. Proofs of the summation formula can be found on its <a href="https://en.wikipedia.org/wiki/Poisson_summation_formula" target="_blank" class="accented">
    Wikipedia page
</a>, though I haven&rsquo;t looked at it hard enough to see if there&rsquo;s an intuitive explanation of it that warrants repeating here. We could always prove $(*)$ using <strong>Approach #1</strong> outlined above.</p>
<!-- It appears that the Fourier transform on a circle is connected to the Fourier transform on $\mathbb Z$. -->
<p>Ultimately, we have only swept the problem under the rug. We still don&rsquo;t understand how to re-discover the Fourier series using the Fourier transform, except by working through $(*)$ first. At least this appears to be a less formidable challenge, one that I might have more to say about in the future. I suspect that a complete theory of the relationships between the various types of Fourier analyses is given by <a href="https://en.wikipedia.org/wiki/Pontryagin_duality" target="_blank" class="accented">
    Pontryagin duality
</a>, although a more immediate and accessible explanation of it would be nice.</p>
<!-- See https://dsp.stackexchange.com/questions/7866/about-the-fourier-transform-of-periodic-signal and https://lpsa.swarthmore.edu/Fourier/Xforms/FXPeriodic.html --><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Unfortunately, there are at least six different conventions for how the Fourier transform and its inverse are defined. We place the factor of $1/2\pi$ on the inverse Fourier transform, and we assume the function to be $2\pi$-periodic. The same convention is followed <a href="https://engineering.purdue.edu/~mikedz/ee301/FourierTransformTable.pdf" target="_blank" class="accented">
    here
</a>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>By the way, it is also possible to derive the Fourier transform from the Fourier series <a href="https://en.wikipedia.org/wiki/Fourier_transform#Fourier_transform_as_the_Fourier_series_of_an_aperiodic_function" target="_blank" class="accented">
    using a Riemann sum
</a>, by letting the &lsquo;period&rsquo; of a &lsquo;periodic function&rsquo; tend to $+\infty$. This is probably more intuitive to work through, since we&rsquo;ve already seen this sort of a calculation in introductory calculus classes.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://math.stackexchange.com/questions/324538/separable-hilbert-space-have-a-countable-orthonormal-basis" target="_blank" class="accented">
    Here's
</a> a more general fact, of which this is a special case.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>This is not an actual Fourier transform pair, just an illustration.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://shirazkn.github.io/tags/harmonic-analysis/">Harmonic Analysis</a></li>
    </ul>
  </footer>
<script src="https://giscus.app/client.js"
        data-repo="shirazkn/shirazkn.github.io"
        data-repo-id="R_kgDOI2VbWw"
        data-category="Announcements"
        data-category-id="DIC_kwDOI2VbW84CWJnt"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
    
    
    
    
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script>

function syncDarkClass() {
    const isDark = document.documentElement.dataset.theme === 'dark';
    document.documentElement.classList.toggle('dark', isDark);
    document.body.classList.toggle('dark', isDark);
}
syncDarkClass();


const themeToggle = document.getElementById('theme-toggle');
if (themeToggle) {
    themeToggle.addEventListener('click', () => {
        setTimeout(syncDarkClass, 0);
    });
}


document.querySelectorAll('.logo a, .post-title').forEach(el => {
    el.innerHTML = el.textContent.trim().split(' ').map(word =>
        `<span class="hover-word">${word.split('').map(char =>
            `<span class="hover-letter">${char}</span>`
        ).join('')}</span>`
    ).join(' ');
});


const isDark = () => document.body.classList.contains('dark');
const hoverColors = isDark()
    ? ['#ff51af', '#ff51af', '#f161ac', '#f161ac', '#db327e', '#db327e', '#3b82f6', '#38bdf8']
    : ['#ff51af', '#ff51af', '#e83a89', '#e83a89', '#f542a1', '#d6306f', '#3b9eff', '#00c2ff'];
document.querySelectorAll('.hover-letter').forEach(letter => {
    letter.addEventListener('mouseenter', () => {
        letter.style.color = hoverColors[Math.floor(Math.random() * hoverColors.length)];
    });
    letter.addEventListener('mouseleave', () => {
        letter.style.color = '';
    });
});


const scanElement = (el) => {
    const letters = el.querySelectorAll('.hover-letter');
    letters.forEach((letter, i) => {
        setTimeout(() => {
            letter.style.transition = 'top 0.05s ease-out, color 0s';
            letter.style.color = hoverColors[Math.floor(Math.random() * hoverColors.length)];
            letter.style.top = '-0.08em';
            setTimeout(() => {
                letter.style.transition = '';
                letter.style.color = '';
                letter.style.top = '';
            }, 100);
        }, i * 50);
    });
};

let lastScannedEl = null;
const triggerRandomScan = () => {
    const logos = Array.from(document.querySelectorAll('.logo a'));
    const titles = Array.from(document.querySelectorAll('.post-title'));
    
    const pickLogo = Math.random() < 0.5 && logos.length > 0;
    let elements = pickLogo ? logos : titles;
    
    if (lastScannedEl && elements.length > 1) {
        elements = elements.filter(el => el !== lastScannedEl);
    }
    if (elements.length > 0) {
        const el = elements[Math.floor(Math.random() * elements.length)];
        lastScannedEl = el;
        scanElement(el);
    }
    
    setTimeout(triggerRandomScan, 4000 + Math.random() * 6000);
};


const isHomePage = document.querySelector('.first-entry.home-info') !== null;


const postCards = document.querySelectorAll('.post-entry');
const isTouchDevice = window.matchMedia('(pointer: coarse)').matches;

if (isTouchDevice && window.isSecureContext && 'DeviceOrientationEvent' in window) {
    
    
    let gyroBaselineBeta = null;
    let gyroBaselineGamma = null;
    const GYRO_DRIFT_RATE = 0.012;
    let gyroRafId = null;
    let latestBeta = null, latestGamma = null;
    let cardGyroPermissionRequested = false;

    
    let currentRotateX = 0, currentRotateY = 0;

    
    let cardFocusValues = new Array(postCards.length).fill(0);
    let scrollRafId = null;

    function updateCardFocus() {
        
        if (scrollRafId) return;
        scrollRafId = requestAnimationFrame(() => {
            const viewportHeight = window.innerHeight;
            const scrollY = window.scrollY;
            const docHeight = document.documentElement.scrollHeight;
            const maxScroll = docHeight - viewportHeight;

            
            const scrollProgress = maxScroll > 0 ? scrollY / maxScroll : 0;
            const viewportFocusPoint = viewportHeight * (0.3 + scrollProgress * 0.4);

            postCards.forEach((card, i) => {
                const rect = card.getBoundingClientRect();
                const cardCenter = rect.top + rect.height / 2;

                
                const distance = Math.abs(cardCenter - viewportFocusPoint);
                const maxDistance = viewportHeight * 0.35; 

                
                const linearFocus = Math.max(0, 1 - distance / maxDistance);
                const focus = linearFocus * linearFocus; 
                cardFocusValues[i] = focus;
            });

            applyCardTransforms();
            scrollRafId = null;
        });
    }

    function applyCardTransforms() {
        postCards.forEach((card, i) => {
            const focus = cardFocusValues[i];
            
            const scale = 1 + focus * 0.02;
            
            const gyroScale = 0.3 + focus * 0.7;
            const rotX = currentRotateX * gyroScale;
            const rotY = currentRotateY * gyroScale;
            
            const shadowOpacity = 0.3 + focus * 0.3;
            const shadowBlur = 2 + focus * 4;

            card.style.transform = `perspective(1000px) rotateX(${rotX}deg) rotateY(${rotY}deg) scale(${scale})`;
            card.style.boxShadow = `0 ${1 + focus * 2}px ${shadowBlur}px rgba(0, 0, 0, ${shadowOpacity})`;
        });
    }

    function handleCardOrientation(event) {
        if (event.beta === null || event.gamma === null) return;

        
        const orientation = screen.orientation?.angle ?? window.orientation ?? 0;
        let beta, gamma;

        if (orientation === 90) {
            beta = event.gamma;
            gamma = -event.beta;
        } else if (orientation === -90 || orientation === 270) {
            beta = -event.gamma;
            gamma = event.beta;
        } else if (orientation === 180) {
            beta = -event.beta;
            gamma = -event.gamma;
        } else {
            beta = event.beta;
            gamma = event.gamma;
        }

        latestBeta = beta;
        latestGamma = gamma;

        if (!gyroRafId) {
            gyroRafId = requestAnimationFrame(() => {
                
                if (gyroBaselineBeta === null) {
                    gyroBaselineBeta = latestBeta;
                    gyroBaselineGamma = latestGamma;
                }

                
                gyroBaselineBeta += (latestBeta - gyroBaselineBeta) * GYRO_DRIFT_RATE;
                gyroBaselineGamma += (latestGamma - gyroBaselineGamma) * GYRO_DRIFT_RATE;

                
                let relativeBeta = latestBeta - gyroBaselineBeta;
                let relativeGamma = latestGamma - gyroBaselineGamma;

                
                if (Math.abs(relativeBeta) > 40 || Math.abs(relativeGamma) > 40) {
                    gyroBaselineBeta = latestBeta;
                    gyroBaselineGamma = latestGamma;
                    relativeBeta = 0;
                    relativeGamma = 0;
                }

                
                currentRotateY = Math.max(-8, Math.min(8, relativeGamma * 0.35));
                currentRotateX = Math.max(-8, Math.min(8, relativeBeta * -0.35));

                applyCardTransforms();
                gyroRafId = null;
            });
        }
    }

    function enableCardGyroscope() {
        window.addEventListener('deviceorientation', handleCardOrientation, { passive: true });
    }

    
    window.addEventListener('scroll', updateCardFocus, { passive: true });
    
    updateCardFocus();

    
    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        
        enableCardGyroscope();

        
        const requestPermission = () => {
            if (cardGyroPermissionRequested) return;
            cardGyroPermissionRequested = true;

            DeviceOrientationEvent.requestPermission()
                .then(state => {
                    if (state === 'granted') {
                        enableCardGyroscope();
                    }
                })
                .catch(() => {
                    cardGyroPermissionRequested = false;
                });
        };
        document.addEventListener('touchstart', requestPermission, { once: true, passive: true });
        document.addEventListener('touchend', requestPermission, { once: true, passive: true });
        document.addEventListener('click', requestPermission, { once: true, passive: true });
    } else {
        
        enableCardGyroscope();
    }
} else {
    
    postCards.forEach(card => {
        let rafId = null;
        let mouseX = 0, mouseY = 0;

        card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;

            if (!rafId) {
                rafId = requestAnimationFrame(() => {
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = (mouseY - centerY) / centerY * -0.8;
                    const rotateY = (mouseX - centerX) / centerX * 0.8;
                    const normalizedY = (centerY - mouseY) / centerY;
                    const isDarkMode = document.body.classList.contains('dark');
                    const baseOpacity = isDarkMode ? 0.35 : 0.15;
                    const opacityRange = isDarkMode ? 0.25 : 0.15;
                    const shadowOpacity = Math.max(0, baseOpacity + normalizedY * opacityRange);
                    const blur = isDarkMode ? 1 : 0.5;
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-1px) scale(1.004)`;
                    card.style.boxShadow = `0 1px ${blur}px rgba(0, 0, 0, ${shadowOpacity})`;
                    rafId = null;
                });
            }
        });
        card.addEventListener('mouseleave', () => {
            if (rafId) {
                cancelAnimationFrame(rafId);
                rafId = null;
            }
            card.style.transform = '';
            card.style.boxShadow = '';
        });
    });
}

if (isHomePage) {
    
    setTimeout(triggerRandomScan, 3000 + Math.random() * 2000);
} else {
    
    setTimeout(() => {
        const logo = document.querySelector('.logo a');
        if (logo) scanElement(logo);

        setTimeout(() => {
            const titles = Array.from(document.querySelectorAll('.post-title'));
            if (titles.length > 0) {
                scanElement(titles[Math.floor(Math.random() * titles.length)]);
            }
            
            setTimeout(triggerRandomScan, 4000 + Math.random() * 6000);
        }, 400);
    }, 800);
}


const tocBox = document.querySelector('.toc');
if (tocBox) {
    const tocDetails = tocBox.querySelector('details');
    if (tocDetails) {
        tocBox.addEventListener('click', (e) => {
            
            if (e.target.tagName === 'A') return;
            
            if (e.target.closest('summary')) return;
            tocDetails.open = !tocDetails.open;
        });
    }
}
</script>
<div class="headerfooter">
    <sub><sup><sub>..</sub></sup></sub>
</div>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            document.documentElement.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            document.documentElement.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
