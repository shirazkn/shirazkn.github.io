<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>The Levi-Civita Connection | Shiraz</title>
<meta name="keywords" content="">
<meta name="description" content="Here, I solve Problem $5-5$ from John Lee&rsquo;s book on Riemannian Manifolds, which demonstrates the non-flatness of the ($2$-)sphere. This problem is particularly interesting because it serves as the motivating example for a later chapter in the book on curvature. As a by-product, we will put to rest the concerns of flat-Earthers.
Connections First, I go over the technical tools needed to state (let alone solve) the problem. A connection $\nabla$ on a smooth manifold $M$ is a way of differentiating vector fields (and more generally, tensors) along curves in $M$:">
<meta name="author" content="">
<link rel="canonical" href="https://shirazkn.github.io/posts/sphere/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.41c5c4f529ce786d89dc3eb49ae8a246b72e45ff4ba97ac417c9b63b7a60891f.css" integrity="sha256-QcXE9SnOeG2J3D60muiiRrcuRf9LqXrEF8m2O3pgiR8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://shirazkn.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://shirazkn.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://shirazkn.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://shirazkn.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://shirazkn.github.io/favicon.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://shirazkn.github.io/posts/sphere/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IM+Fell+DW+Pica">
  

<meta property="og:title" content="The Levi-Civita Connection" />
<meta property="og:description" content="Here, I solve Problem $5-5$ from John Lee&rsquo;s book on Riemannian Manifolds, which demonstrates the non-flatness of the ($2$-)sphere. This problem is particularly interesting because it serves as the motivating example for a later chapter in the book on curvature. As a by-product, we will put to rest the concerns of flat-Earthers.
Connections First, I go over the technical tools needed to state (let alone solve) the problem. A connection $\nabla$ on a smooth manifold $M$ is a way of differentiating vector fields (and more generally, tensors) along curves in $M$:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shirazkn.github.io/posts/sphere/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-24T10:43:16-04:00" />
<meta property="article:modified_time" content="2024-03-24T10:43:16-04:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The Levi-Civita Connection"/>
<meta name="twitter:description" content="Here, I solve Problem $5-5$ from John Lee&rsquo;s book on Riemannian Manifolds, which demonstrates the non-flatness of the ($2$-)sphere. This problem is particularly interesting because it serves as the motivating example for a later chapter in the book on curvature. As a by-product, we will put to rest the concerns of flat-Earthers.
Connections First, I go over the technical tools needed to state (let alone solve) the problem. A connection $\nabla$ on a smooth manifold $M$ is a way of differentiating vector fields (and more generally, tensors) along curves in $M$:"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://shirazkn.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "The Levi-Civita Connection",
      "item": "https://shirazkn.github.io/posts/sphere/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "The Levi-Civita Connection",
  "name": "The Levi-Civita Connection",
  "description": "Here, I solve Problem $5-5$ from John Lee\u0026rsquo;s book on Riemannian Manifolds, which demonstrates the non-flatness of the ($2$-)sphere. This problem is particularly interesting because it serves as the motivating example for a later chapter in the book on curvature. As a by-product, we will put to rest the concerns of flat-Earthers.\nConnections First, I go over the technical tools needed to state (let alone solve) the problem. A connection $\\nabla$ on a smooth manifold $M$ is a way of differentiating vector fields (and more generally, tensors) along curves in $M$:",
  "keywords": [
    
  ],
  "articleBody": "Here, I solve Problem $5-5$ from John Lee’s book on Riemannian Manifolds, which demonstrates the non-flatness of the ($2$-)sphere. This problem is particularly interesting because it serves as the motivating example for a later chapter in the book on curvature. As a by-product, we will put to rest the concerns of flat-Earthers.\nConnections First, I go over the technical tools needed to state (let alone solve) the problem. A connection $\\nabla$ on a smooth manifold $M$ is a way of differentiating vector fields (and more generally, tensors) along curves in $M$:\n\\[ \\nabla : \\mathfrak X(M) \\times \\mathfrak X(M) \\to \\mathfrak X(M) \\] where $\\mathfrak X(M)$ denotes the space of smooth vector fields on $M$. The axioms/properties that must be satisfied by a connection (specifically, a Koszul connection) can be found in Lee’s book, so I will focus on the insights.\nMore generally, let $\\pi_E: E \\rightarrow M$ be a vector bundle over $M$. A connection on $E$ is a map $\\nabla: \\mathfrak X(M) \\times \\Gamma(E) \\rightarrow \\Gamma(E)$ satisfying the Leibniz rule. A connection on $TM$ (called a linear or affine connection) arises as a special case of this construction. Another important example is the $C^\\infty(M)$ functions, which can be viewed as sections of the vector bundle $\\pi : M \\times \\mathbb R \\rightarrow M$. We write $\\nabla X: \\mathfrak X(M) \\rightarrow \\mathfrak X(M)$ to denote the total covariant derivative of $X$, with the intention that $\\nabla X(Y) = \\nabla _Y X$ inserts $Y$ into the first slot of $\\nabla$. Compare this with the map $\\nabla _X:\\mathfrak X(M) \\rightarrow \\mathfrak X(M)$ which inserts $Y$ into the second slot of $\\nabla$. The former is $C^\\infty(M)$-linear in $Y$, while the latter is $\\mathbb R$-linear but not $C^\\infty(M)$-linear in $Y$. That is, we have $C^\\infty(M)$-linearity in the first slot:\n\\[ \\nabla X (fY) = \\nabla _{fY} X = f \\nabla X (Y) \\] but a product/Leibnitz rule in the second slot:\n\\[ \\nabla _X (fY) = X(f) + f \\nabla _X Y \\] Since the total covariant derivative $\\nabla X$ is $C^\\infty(M)$-linear, it is a tensor, but the connection itself is not a tensor.\nThe Levi-Civita Connection There is a lot of freedom in choosing a connection on a Riemannian manifold. Once chosen, a connection specifies a rule for ‘connecting’ the nearby tangent spaces (or more generally, fibers of a vector bundle) of the manifold, thereby defining a notion of differentiation of vector fields. The fundamental theorem of Riemannian geometry says that there exists a unique connection, called the Levi-Civita connection, that satisfies the following properties:\nMetric Compatibility: $\\nabla _X \\langle Y, Z \\rangle = \\langle \\nabla _X Y, Z \\rangle + \\langle Y, \\nabla_X Z \\rangle $ The Torsion-Free Property/Symmetry: $ \\nabla _X Y - \\nabla _Y X = [X, Y]$ The first of these can be viewed as a Leibniz/product rule for the metric1. The second property is a bit more mysterious; I like to think that Property 2 is about the compatibility of the connection with the flows (and thus, the differential structure) of $M$, whereas Property 1 is about compatibility with the geometry. The following discussion will shed more light into torsion-free connections.\nComparison with the Lie Derivative ($\\mathcal L_X$) As suggested in the aside (the indented grey box) above, the connection defines a derivative of $C^\\infty (M)$ functions in the following sense:\n\\[ \\nabla _X f = \\mathcal L_X f = X(f) \\in C^\\infty (M) \\] which is also the same as $df(X)$, $d$ being the exterior derivative. So, $\\nabla _X$ and $\\mathcal L_X$ operate similarly on functions. However, $\\nabla _X Y \\neq \\mathcal L_X Y$ (in general) when $Y \\in \\mathfrak X(M)$. This was for me one of the biggest conceptual difficulties while self-studying Riemannian geometry, so it is worth dwelling on the point.\nRecall that\n\\[ \\mathcal L_X Y(f) = [X, Y](f) = X\\big(Y(f)\\big) - Y\\big(X(f)\\big) \\] which means that $\\mathcal L_X Y = [X, Y]$ is simply the Lie bracket of vector fields. We observe the following points of departure between $\\nabla _X Y$ and $\\mathcal L_X Y$:\nThe Lie derivative is well-defined once a smooth structure for $M$ is specified, whereas the connection is an additional structure that is imposed on $M$; in particular, endowing $M$ with geometry uniquely specifies the Levi-Civita connection. Importantly, there is no natural choice of a connection on a smooth manifold until a metric is chosen for it\nThe Lie derivative $\\mathcal L_X Y$ at $p\\in M$ is defined via local flows/diffeomorphisms of $X$ near $p$, whereas $\\nabla _X Y$ only depends on the vector $X_p \\in T_p M$\n$X \\mapsto \\mathcal L_X$ is only an $\\mathbb R$-linear map (and therefore, not a tensor), whereas $X \\mapsto \\nabla_X$ is $C^\\infty(M)$-linear2. Neither of $\\mathcal L_X(\\hspace{1pt}\\cdot\\hspace{1pt})$ and $\\nabla_X(\\hspace{1pt}\\cdot\\hspace{1pt})$ is $C^\\infty(M)$-linear\nIf $\\nabla$ is torsion-free, then the torsion-free condition can be rearranged to yield\n\\[ \\nabla_ X Y = \\big(\\nabla X + \\mathcal L_ X\\big) Y \\] The first of these is a $C^\\infty(M)$-linear transformation of $Y$, so $\\nabla _X$ can be viewed as an affine transformation, with $\\mathcal L_X$ playing the role of translation. The presence of $\\mathcal L_X$ destroys the linearity of $\\nabla _X$, until and unless $X$ and $Y$ commute, in which case $\\mathcal L_X Y = [X, Y] \\equiv 0$. Tangential Connection In general, the connection is given with respect to a smooth local frame $({E_i})_{i=1}^n$ on $U\\subseteq M$ by $\\nabla _{E_i} E_j = \\Gamma_{ij}^k E_k$, where $\\Gamma_{ij}^k$ are called the Christoffel symbols of the connection with respect to $(E_i)_{i=1}^n$, and Einstein summation is implied. The Christoffel symbols specify the action of $\\nabla$ on arbitrary vector fields on $U$:\n\\[ \\nabla_X Y = X(Y^i) E_i + Y^i \\nabla_X E_i = \\big(X(Y^k) + X^i Y^j \\Gamma_{ij}^k \\big)E_k \\] where $Y = Y^i E_i$ is the expansion of $Y$ in the frame $(E_i)_{i=1}^n$. The Christoffel symbols $\\Gamma_{ij}^k$ of the Levi-Civita connection can be expressed using the second Christoffel identity (which relies on coordinates) or by using the Koszul formula (which is coordinate-free); see Corollary $5.11$ in Lee’s book (on Riemannian manifolds).\nSimilar to how the Whitney embedding theorem allows us to embed $M$ in $\\mathbb R^{2n},$ a theorem attributed to John Nash says that any Riemannian manifold can be isometrically embedded in a higher-dimensional Euclidean space. Sometimes, a more straightforward way to work with the Levi-Civita connection is to isometrically embed $M$ in a higher-dimensional Euclidean space, and then (in a sense) pull back the Euclidean connection to $M$. This is considered the extrinsic approach and comes at the risk of obscuring the intrinsic structure of $M$. Let $\\mathbb R^{\\bar n}$ be the Euclidean $\\bar n$-space having the Euclidean metric $\\bar g$. Its Levi-Civita connection is given by\n\\[ \\overline \\nabla_X Y = X(Y^i) \\frac{\\partial}{\\partial x^i} \\] which is precisely how a naive calculus student would differentiate vector fields – the Riemannian geometer should be aware that this formula only holds because the Christoffel symbols are all $0$ in this case.\nNow, let $\\pi: T_p \\mathbb R^{\\bar n} \\rightarrow T_p M$ be the orthogonal projection of tangent vectors of $\\mathbb R^{\\bar n}$ onto $T_p M$. Then, the Levi-Civita connection on $M$, denoted $\\nabla$, is given by\n\\[ \\nabla_X Y = \\pi \\left(\\overline \\nabla_{\\overline X} \\overline Y\\right) \\] where $\\overline X$ and $\\overline Y$ are smooth extensions of $X$ and $Y$ to an open set of $\\mathbb R^{\\bar n}$, respectively. This paints an extrinsic picture of the covariant derivative: it is the rate of change of $Y$ along $X$ as seen from within $M$, i.e., changes in $Y$ that are normal to $M$ are disregarded.\nWe are ready to attempt Problem $5-5$ from Lee’s book.\nThe Sphere A vector field $X$ is said to be a parallel vector field if $\\nabla X$ is identically $0$. A (local) parallel coordinate frame (see my other post for an introduction to coordinate frames) exists on (an open set of) a manifold $M$ if and only if $M$ is (locally) flat. Here, local (or global) flatness refers to the property of being locally (or globally) isometric to an open set of the Euclidean space of the same dimension.\nA $2$-dimensional manifold is locally flat if and only if a small piece (i.e., an open set) cut out from it can be laid flat on the table without stretching, tearing, or crumpling it. The surface of a Cylinder and the Möbius strip (with a certain, natural choice of metric for it) are examples of locally flat surfaces; this is exactly why one can construct these surfaces from a piece of paper. The crux of Problem $5-5$ is to show that such a local parallel vector field does not exist on the sphere $S^2$. (This can be compared to the difficulty of drawing a map of the Earth that does not introduce distortions of some sort.)\nFirst, Lee asks us to consider the following embedding of the $2$-sphere in $\\mathbb R^3$:\n\\[ \\begin{aligned} \\psi: U \u0026\\rightarrow \\mathbb R^3 \\\\ (x^1, x^2) \u0026\\mapsto \\left(\\sin x^1 \\cos x^2, \\sin x^1 \\sin x^2, \\cos x^1\\right) \\end{aligned} \\] where $U\\subseteq S^2$ is an open set on the sphere and $(x^1, x^2)$ are the usual spherical polar coordinates on the sphere; technically, $\\psi$ is the pullback of an embedding under the spherical polar parameterization:\nEmbedding of the sphere in $\\mathbb R^3$ In the illustration, we use a ‘wobbly sphere’ to remind us that $S^2$ does not necessarily come endowed with geometry. Rather, by treating $\\hat \\psi$ as an isometry, we will ‘pull back’ the geometry of $\\mathbb R^3$ onto $S^2$. To this end, consider the frame $\\big(\\frac{\\partial}{\\partial x^1}, \\frac{\\partial}{\\partial x^2}\\big)$ on $\\mathbb R^2$3. We know that $\\varphi ^{-1}$ pushes this forward, yielding the local coordinate frame $(\\varphi ^{-1}_*\\frac{\\partial}{\\partial x^1},\\varphi ^{-1}_*\\frac{\\partial}{\\partial x^2})$ on $S^2$. It can then be pushed forward to $\\mathbb R^3$, giving us\n\\[ \\Big(\\hat \\psi_*\\big(\\varphi ^{-1}_*\\frac{\\partial}{\\partial x^1}\\big), \\hat \\psi_*\\big(\\varphi ^{-1}_*\\frac{\\partial}{\\partial x^2} \\big) \\Big) = \\Big(\\psi_*\\frac{\\partial}{\\partial x^1}, \\psi_*\\frac{\\partial}{\\partial x^2} \\Big). \\] Denote the standard frame in $\\mathbb R^3$ by $(\\frac{\\partial}{\\partial y^1}, \\frac{\\partial}{\\partial y^2}. \\frac{\\partial}{\\partial y^3})$. We have (using the usual chain rule),\n\\[ \\begin{aligned} X \\coloneqq \\psi_* \\frac{\\partial}{\\partial x^1} \u0026= \\cos x^1 \\cos x^2 \\frac{\\partial}{\\partial y^1} + \\cos x^1 \\sin x^2 \\frac{\\partial}{\\partial y^2} - \\sin x^1 \\frac{\\partial}{\\partial y^3}, \\\\ Y \\coloneqq \\psi_* \\frac{\\partial}{\\partial x^2} \u0026= -\\sin x^1 \\sin x^2 \\frac{\\partial}{\\partial y^1} + \\sin x^1 \\cos x^2 \\frac{\\partial}{\\partial y^2}. \\end{aligned} \\] So, there is a good reason for distinguishing between $(x^1, x^2)$ and $(y^1, y^2, y^3)$. The second of these vector fields is $Y = -y^2 \\frac{\\partial}{\\partial y^1} + y^1 \\frac{\\partial}{\\partial y^2}$, and the first is more complicated to write in terms of $(y^1, y^2, y^3)$.\nAre $X$ and $Y$ Parallel? If they are, then we will conclude that the sphere is flat.\nObserve that $X$ are the longitudinal (i.e., vertical) vector fields on the sphere, and $Y$ are the latitudinal (i.e., horizontal) vector fields. Lee asks us to compute $\\nabla_{X} X$ and $\\nabla_{Y} X$ to assess the parallel-ness of $X$, with $\\nabla$ being the tangential connection. I tried this using the standard (Cartesian) coordinate frame of $\\mathbb R^3$, but the computations are cumbersome. For instance, we have\n\\[ \\begin{align*} \\overline \\nabla_{\\overline Y} {\\overline X} \u0026= {\\overline Y}({\\overline X}^1) \\frac{\\partial}{\\partial y^1} + {\\overline Y}({\\overline X}^2) \\frac{\\partial}{\\partial y^2} + {\\overline Y}({\\overline X}^3) \\frac{\\partial}{\\partial y^3}\\\\ \u0026= \\overline Y\\left(\\frac{y^3 y^1}{\\sqrt{{y^1}^2 + {y^2}^2}}\\right)\\frac{\\partial}{\\partial y^1} + \\overline Y\\left(\\frac{y^3 y^2}{\\sqrt{{y^1}^2 + {y^2}^2}}\\right)\\frac{\\partial}{\\partial y^2} \\\\ \u0026\\qquad + \\overline Y\\left(-\\sqrt{{y^1}^2 + {y^2}^2}\\right)\\frac{\\partial}{\\partial y^3}\\\\ \u0026= \\frac{-y^2 y^3}{\\sqrt{{y^1}^2 + {y^2}^2}}\\frac{\\partial}{\\partial y^1} + \\frac{y^1 y^3}{\\sqrt{{y^1}^2 + {y^2}^2}}\\frac{\\partial}{\\partial y^2} \\end{align*} \\] Here, I considered the map $(x^1,x^2) \\mapsto (x^3 \\sin x^1 \\cos x^2, x^3 \\sin x^1 \\sin x^2, x^3 \\cos x^1)$ in order to define extensions of $X$ and $Y$ to open sets of $\\mathbb R^3$, yielding $\\overline X$ and $\\overline Y$, which is the first step in the computation of the tangential connection. Even without projecting onto the sphere (recall the definition of a tangential connection), we see that $\\overline \\nabla_{\\overline Y} {\\overline X}$ is $0$ when $y^3=0$, meaning that $X$ is parallel along the equator of the sphere. The computation of $\\overline \\nabla_{\\overline X} {\\overline X}$ can also be done in this way, but it will be messy. Let’s look for a better approach.\nBefore we get there, what do you think $\\nabla _X X$ will turn out to be? Here’s a hint: the integral curves of $X$ are said to be geodesics (locally length-minimizing paths) if and only if $X$ is parallel along its integral curves, i.e., $\\nabla _X X = 0$. What are the geodesics of the sphere? You might know these as the paths that airplanes like to take when flying long distances.\nUsing a Coordinate Frame The frame $\\left(\\frac{\\partial}{\\partial y_1}, \\frac{\\partial}{\\partial y_2}, \\frac{\\partial}{\\partial y_3}\\right)$ is a global coordinate frame for $\\mathbb R^3$ derived from the standard/trivial coordinates, $(y^1,y^2, y^3) \\mapsto (y^1,y^2, y^3)$. It is attractive to us because it is orthonormal (the metric tensor coefficients are $\\delta_{ij}$, making the metric reduce to a dot product), and the Christoffel symbols $\\lbrace\\Gamma_{ij}^k\\rbrace_{i,j,k=1}^3$ of the Levi-Civita connection $\\overline \\nabla$ are all identically $0$.\nLet’s construct a different coordinate frame for $\\mathbb R^3$. We consider the spherical polar parametrization of $\\mathbb R^3$, $(\\varphi, \\theta, r) \\mapsto (r \\sin \\varphi \\cos \\theta, r \\sin \\varphi \\sin \\theta, r \\cos \\varphi)$. This induces a coordinate frame $(\\partial_\\varphi, \\partial_\\theta, \\partial_r)$ with $\\partial_\\varphi\\vert_{r=1}=X$ and $\\partial_\\theta\\vert_{r=1}=Y$; the vertical line ‘$\\vert$’ is read as ‘restricted to’. This frame is not defined along the $y^3$ axis, but that’s okay – it is a local coordinate frame.\nIt seems as if this should simplify the calculation greatly, so (by an application of the no free lunch theorem ) there must be a catch. The catch is that the frame $(\\partial_\\varphi, \\partial_\\theta, \\partial_r)$ is not orthonormal, so we need to compute the Christoffel symbols of the Levi-Civita connection with respect to this frame. (Chapter 7 of Lee shows that a local orthonormal coordinate frame can exist if and only if the manifold is locally flat; this is yet another way of demonstrating the non-flatness of the sphere.)\nLet’s look at the metric tensor coefficients $g_{ij}$. We have, $g_{11}=\\langle \\partial_\\varphi, \\partial_\\varphi \\rangle$, with\n\\[ \\begin{align} \\partial_\\varphi \u0026= r \\cos \\varphi \\cos \\theta \\frac{\\partial}{\\partial y^1} + r \\cos \\varphi \\sin \\theta \\frac{\\partial}{\\partial y^2} - r \\sin \\varphi \\frac{\\partial}{\\partial y^3}\\\\ \\partial_\\theta \u0026= -r \\sin \\varphi \\sin \\theta \\frac{\\partial}{\\partial y^1} + r \\sin \\varphi \\cos \\theta \\frac{\\partial}{\\partial y^2}\\\\ \\partial_r \u0026= \\sin \\varphi \\cos \\theta \\frac{\\partial}{\\partial y^1} + \\sin \\varphi \\sin \\theta \\frac{\\partial}{\\partial y^2} + \\cos \\varphi \\frac{\\partial}{\\partial y^3} \\end{align} \\] so that $g_{11}(\\varphi, \\theta, r) = r^2$. Completing the metric tensor, we find that $g_{22}(\\varphi, \\theta, r) = r^2 \\sin^2 \\varphi$ and $g_{33}(\\varphi, \\theta, r) = 1$. Amazingly (but as expected), $g_{12}$, $g_{13}$, $g_{23}$, and their symmetric counterparts are all identically $0$.4 The Christoffel symbols in a coordinate frame are given by the formula\n\\[ \\begin{align} \\Gamma_{ij}^k \u0026= \\frac{1}{2} g^{kl} \\left( \\partial_i g_{jl} + \\partial_j g_{il} - \\partial_l g_{ij} \\right) \\end{align} \\] where $g^{ij}$ are coefficients of the inverse of the metric tensor (see p. 123 of Lee). So, we have\n\\[ \\begin{align} \\Gamma_{11}^3 = -r, \\quad \\Gamma_{12}^2=\\frac{\\cos \\varphi}{\\sin \\varphi}, \\quad \\Gamma_{13}^1 = \\frac{1}{r}. \\end{align} \\] giving us\n\\[ \\begin{align} \\overline \\nabla_{\\overline X} \\overline X \u0026= \\overline \\nabla_{\\partial_\\varphi} \\partial_\\varphi \\\\ \u0026= \\overline \\nabla_{\\partial_1} \\partial_1 =\\Gamma_{11}^3 \\partial_3 = -r \\partial_r \\end{align} \\] Since $\\overline \\nabla_{\\overline X} \\overline X$ is purely in the radial direction, we have that $\\nabla _X X = \\pi \\left(\\overline \\nabla_{\\overline X} \\overline X\\right) =0$. Thus, $X$ is indeed parallel along its own integral curves; the integral curves of $X$ are segments of the geodesics (i.e., great circles) passing through the poles.\nLastly, we compute $\\nabla _Y X$ in the new frame:\n\\[ \\begin{align} \\overline \\nabla_{\\overline Y} \\overline X \u0026= \\overline \\nabla_{\\partial_\\theta} \\partial_\\varphi \\\\ \u0026= \\overline \\nabla_{\\partial_2} \\partial_1 = \\Gamma_{21}^2 \\partial_2 = \\frac{\\cos \\varphi}{\\sin \\varphi} \\partial_\\theta\\\\ \\Rightarrow \\nabla_{Y} X \u0026= \\pi \\left( \\overline \\nabla_{\\overline Y} \\overline X\\right )=\\frac{\\cos \\varphi}{\\sin \\varphi} \\partial_\\theta \\end{align} \\] (since $\\Gamma_{21}^2=\\Gamma_{12}^2$ for the Levi-Civita connection). As we deduced before, $X$ is only parallel in the horizontal/latitudinal directions if $\\cos \\varphi =0$, i.e., at the equator. In conclusion, $\\nabla X \\neq 0$.\nCould there be another parallel frame? We have only shown that $(X,Y)$ is not a parallel frame, which does not preclude the existence of another parallel coordinate frame. Lee asks us to consider the point $(y^1, y^2, y^3)=(1,0,0)$ in $\\mathbb R^3$, and show that there is no parallel coordinate frame near this point. By symmetry, the argument would extend to other points on the sphere. I omit the arguments here, but page $194$ of Lee’s book outlines the process of constructing a parallel frame near $p=(1,0,0)$. The key idea is that such an attempt to construct a parallel vector field would both (i) coincide with $X$, and (ii) fail to be parallel.\nThe insistence of the frame being a coordinate frame (i.e., pushforwards of coordinate vector fields) is crucial. There may exist local orthonormal frames on non-flat manifolds that are orthonormal or parallel but are not coordinate frames. See the last section of this post for further discussion. Some Stronger Claims In the above, we worked with a specific isometric embedding of the sphere in $\\mathbb R^3$, restricting our investigation to a specific choice of a metric. Could another metric be prescribed for the sphere that makes it flat (or equivalently, enables us to prescribe a local orthonormal/parallel coordinate frame)? Firstly, we belabor the point that flatness is dependent on the metric at all.\nThe non-flat torus: The 2-torus $\\mathbb T^2 \\cong S^1 \\times S^1$ can be embedded in $\\mathbb R^3$ as a donut: this is not flat, because parallel transport of a vector from inside the hole (i.e., close to the axis) of the donut to the outside (i.e., far from the axis) would need to preserve its length, posing an obstacle to the construction of a parallel coordinate frame. Equivalently, one cannot wrap a piece of paper around a donut (unless the length or width of the piece of paper were vanishingly small) without introducing creases or folds in the paper.\nThe flat torus: At the same time, the 2-torus can be embedded in $\\mathbb R^4$ (analogous to how a circle can be embedded in $R^2$5) or realized as the quotient manifold $\\mathbb R^2/\\mathbb Z^2$. The latter two constructions would give rise to natural choices of flat metrics. We conclude that $\\mathbb T^2$ admits a flat metric, but the donut (which is $\\mathbb T^2$ with a specific choice of metric) is not flat. That being said, it is possible to isometrically embed the flat torus in $\\mathbb R^3$; these researchers are working on visualizing such an embedding, and observe that it has a self-similar, fractal-like structure, indicating that the situation is much more subtle than our naive conception of the donut.\nThe locally flat sphere: The sphere does admits a metric that is locally flat (near a given point, $p\\in \\mathbb S^2$). To see this, we take a cube in $\\mathbb R^3$ and smooth all of its edges and corners (to make it smooth); this smoothed cube is now a smooth embedding of the sphere in $\\mathbb R^3$, and its pullback metric is certainly (locally) flat near some of the points. So, a more appropriate question to ask is whether the sphere can be globally flat, i.e., does it admit a metric that is flat in every neighborhood, even near the ’edges’ of the smoothed cube?\nThe (non-existence of a) globally flat sphere: Surprisingly, the answers to such questions come from algebraic geometry, having their roots in combinatorics (i.e., counting arguments). The Euler characteristic of the sphere, combined with the Gauss-Bonnet theorem can be used to show that the sphere does not admit a globally flat metric. Here’s another proof that relies on a theorem that may be familiar (or at least accessible) to most readers. Let $(S^2, g)$ be a hypothesized flat metric on the sphere. There exists then, a global parallel vector field $X$. By metric compatibility of the corresponding Levi-Civita connection, we have\n\\[ \\nabla_Y \\langle X,X \\rangle = \\langle \\nabla_Y X, X \\rangle + \\langle X, \\nabla_Y X \\rangle = 0 \\] This means that if $\\langle X, X\\rangle _p \\neq 0$ at some point $p$, then $\\langle X, X\\rangle$ (and therefore, $X$) does not vanish anywhere on $S^2$. The hairy ball theorem says that this is impossible – a contradiction.\nA Word of Caution! The most confusing part of self-learning Riemannian geometry has been, for me, the conflation between frames and coordinate frames. I suggest that the reader familiarizes theirself with the definition of either (a coordinate chart induces a frame, but not every frame is the frame derived from a coordinate chart). Every time you encounter a formula, statement, or theorem, take care to check whether it only holds for a coordinate frame.\nThe following examples show why this distinction is important:\nThe left-invariant vector fields $(E_i)_{i=1}^n$ of a Lie group form a global, orthonormal (after carrying out the Gram-Schmidt process) frame. Does this mean that every Lie group is globally flat? No, because the frame of left-invariant vector fields on a non-Abelian Lie group is not a coordinate frame. To see this, observe that $[E_i, E_j] \\neq 0$ whereas the Lie brackets must vanish in a coordinate frame (since the partial derivative operators of $\\mathbb R^n$ commute).6\nFor the same reason, it is seldom possible to choose an orthonormal coordinate frame. One either gives up orthonormality (choosing to introduce a metric tensor) or gives up the coordinate frame (choosing to work with a frame that is not a coordinate frame, such as $(E_i)_{i=1}^n$).\nThe Christoffel symbols of the Levi-Civita connection are symmetric in the lower indices ($\\Gamma_{ij}^k = \\Gamma_{ji}^k$), but this is only true in a coordinate frame.\nThe identity we used to compute the Christoffel symbols in this post only holds in a coordinate frame. In a non-coordinate frame, we would replace it with the appropriate formula in Corollary 5.11 of Lee’s book.\nThe metric compatibility condition is equivalent to the condition that $\\nabla g \\equiv 0$, though to define what this even means, we need to understand how the connection on $TM$ induces a connection on symmetric $(0,2)$-tensors on $M$ (of which the metric tensor $g$ is an example). ↩︎\nNote that $\\mathcal L_{fX} Y = [fX,Y] = -\\mathcal L_Y (fX)$, so the Lie derivative satisfies a Leibniz/product rule in either of its arguments. ↩︎\nThis frame looks like a net/mesh on $\\mathbb R^2$ but gets warped when it’s pushed forward to $S^2$. ↩︎\nI find it remarkable that this frame is orthogonal but not orthonormal (and moreover, not constant), and that in itself is enough to pose an obstruction to flatness. ↩︎\nNote that $S^1$ (and in fact, all one-dimensional smooth manifolds) is flat independently of the choice of metric; a piece of string/yarn can always be curved into another shape of desire. Consequently, the product metric on $S^1\\times S^1$ is flat as well. ↩︎\nThe left-invariant vector fields do induce coordinates on a connected Lie group, called the exponential coordinates: $(x^1, \\cdots, x^n) \\mapsto \\exp \\left(\\sum_{i=1}^n x^i (E_i)_e\\right)$. However, even for the matrix exponential, the sum inside $\\exp$ splits into a product of $\\exp$s only when $(E_1, \\cdots, E_n)$ commute with each other, i.e., when their pairwise Lie brackets vanish. ↩︎\n",
  "wordCount" : "3850",
  "inLanguage": "en",
  "datePublished": "2024-03-24T10:43:16-04:00",
  "dateModified": "2024-03-24T10:43:16-04:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://shirazkn.github.io/posts/sphere/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Shiraz",
    "logo": {
      "@type": "ImageObject",
      "url": "https://shirazkn.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://shirazkn.github.io/" accesskey="h" title="Shiraz (Alt + H)">Shiraz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://shirazkn.github.io/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="https://shirazkn.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      The Levi-Civita Connection
    </h1>
    <div class="post-meta"><span title='2024-03-24 10:43:16 -0400 EDT'>March 24, 2024</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#connections" aria-label="Connections">Connections</a><ul>
                        
                <li>
                    <a href="#the-levi-civita-connection" aria-label="The Levi-Civita Connection">The Levi-Civita Connection</a></li>
                <li>
                    <a href="#comparison-with-the-lie-derivative--mathcal-l_x" aria-label="Comparison with the Lie Derivative  ($\mathcal L_X$)">Comparison with the Lie Derivative  ($\mathcal L_X$)</a></li>
                <li>
                    <a href="#tangential-connection" aria-label="Tangential Connection">Tangential Connection</a></li></ul>
                </li>
                <li>
                    <a href="#the-sphere" aria-label="The Sphere">The Sphere</a><ul>
                        
                <li>
                    <a href="#are-x-and-y-parallel" aria-label="Are $X$ and $Y$ Parallel?">Are $X$ and $Y$ Parallel?</a><ul>
                        
                <li>
                    <a href="#using-a-coordinate-frame" aria-label="Using a Coordinate Frame">Using a Coordinate Frame</a></li>
                <li>
                    <a href="#could-there-be-another-parallel-frame" aria-label="Could there be another parallel frame?">Could there be another parallel frame?</a></li></ul>
                </li>
                <li>
                    <a href="#some-stronger-claims" aria-label="Some Stronger Claims">Some Stronger Claims</a></li>
                <li>
                    <a href="#a-word-of-caution" aria-label="A Word of Caution!">A Word of Caution!</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Here, I solve Problem $5-5$ from John Lee&rsquo;s book on <em>Riemannian Manifolds</em>, which demonstrates the non-flatness of the ($2$-)sphere. This problem is particularly interesting because it serves as the motivating example for a later chapter in the book on <span class=accented>curvature</span>.
As a by-product, we will put to rest the concerns of flat-Earthers.</p>
<h1 id="connections">Connections<a hidden class="anchor" aria-hidden="true" href="#connections">#</a></h1>
<p>First, I go over the technical tools needed to state (let alone solve) the problem.
A <em>connection</em> $\nabla$ on a smooth manifold $M$ is a way of differentiating vector fields (and more generally, tensors) along curves in $M$:</p>
<p>
\[
    \nabla : \mathfrak X(M) \times \mathfrak X(M) \to \mathfrak X(M)
    \]
</p> 
<p>where $\mathfrak X(M)$ denotes the space of smooth vector fields on $M$. The axioms/properties that must be satisfied by a connection (specifically, a <em>Koszul connection</em>) can be found in Lee&rsquo;s book, so I will focus on the insights.</p>
<aside class=aside-center>
More generally, let $\pi_E: E \rightarrow M$ be a vector bundle over $M$. A connection on $E$ is a map $\nabla: \mathfrak X(M) \times \Gamma(E) \rightarrow \Gamma(E)$ satisfying the Leibniz rule. A connection on $TM$ (called a <i>linear</i> or <i>affine</i> connection) arises as a special case of this construction. 
Another important example is the $C^\infty(M)$ functions, which can be viewed as sections of the vector bundle $\pi : M \times \mathbb R \rightarrow M$.
</aside>
<!-- ## Total Covariant Derivative -->
<p>We write $\nabla X: \mathfrak X(M) \rightarrow \mathfrak X(M)$ to denote the <span class=accented>total covariant derivative</span> of $X$, with the intention that $\nabla X(Y) = \nabla _Y X$ inserts $Y$ into the first slot of $\nabla$. Compare this with the map $\nabla _X:\mathfrak X(M) \rightarrow \mathfrak X(M)$ which inserts $Y$ into the second slot of $\nabla$. The former is $C^\infty(M)$-linear in $Y$, while the latter is $\mathbb R$-linear but not $C^\infty(M)$-linear in $Y$. That is, we have $C^\infty(M)$-linearity in the first slot:</p>
<p>
\[
    \nabla X (fY) = \nabla _{fY} X = f \nabla X (Y)
    \]
    </p>
<p>but a product/Leibnitz rule in the second slot:</p>
<p>
\[
    \nabla _X (fY) = X(f) + f \nabla _X Y
    \]
    </p>
<p>Since the total covariant derivative $\nabla X$ is $C^\infty(M)$-linear, it is a tensor, but the connection itself is not a tensor.</p>
<h2 id="the-levi-civita-connection">The Levi-Civita Connection<a hidden class="anchor" aria-hidden="true" href="#the-levi-civita-connection">#</a></h2>
<p>There is a lot of freedom in choosing a connection on a Riemannian manifold. Once chosen, a connection specifies a rule for &lsquo;<em>connecting</em>&rsquo; the nearby tangent spaces (or more generally, fibers of a vector bundle) of the manifold, thereby defining a notion of differentiation of vector fields. The fundamental theorem of Riemannian geometry says that there exists a unique connection, called the <span class=accented>Levi-Civita connection</span>, that satisfies the following properties:</p>
<ol>
<li><b>Metric Compatibility:</b> $\nabla _X \langle Y, Z \rangle = \langle \nabla _X Y, Z \rangle + \langle Y, \nabla_X Z \rangle $</li>
<li><b>The Torsion-Free Property/Symmetry:</b> $ \nabla _X Y - \nabla _Y X = [X, Y]$</li>
</ol>
<p>The first of these can be viewed as a Leibniz/product rule for the metric<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. The second property is a bit more mysterious; I like to think that Property 2 is about the compatibility of the connection with the flows (and thus, the differential structure) of $M$, whereas Property 1 is about compatibility with the geometry. The following discussion will shed more light into torsion-free connections.</p>
<h2 id="comparison-with-the-lie-derivative--mathcal-l_x">Comparison with the Lie Derivative  ($\mathcal L_X$)<a hidden class="anchor" aria-hidden="true" href="#comparison-with-the-lie-derivative--mathcal-l_x">#</a></h2>
<p>As suggested in the aside (the indented grey box) above, the connection defines a derivative of $C^\infty (M)$ functions in the following sense:</p>
<p>
\[
\nabla _X f = \mathcal L_X f = X(f) \in C^\infty (M)    
    \]
</p>
<p>which is also the same as $df(X)$, $d$ being the exterior derivative.
So, $\nabla _X$ and $\mathcal L_X$ operate similarly on functions. However, $\nabla _X Y \neq \mathcal L_X Y$ (in general) when $Y \in \mathfrak X(M)$. This was for me one of the biggest conceptual difficulties while self-studying Riemannian geometry, so it is worth dwelling on the point.</p>
<p>Recall that</p>
<p>
\[
    \mathcal L_X Y(f) = [X, Y](f) = X\big(Y(f)\big) - Y\big(X(f)\big)
    \]
</p>     
<p>which means that $\mathcal L_X Y = [X, Y]$ is simply the Lie bracket of vector fields. We observe the following points of departure between $\nabla _X Y$ and $\mathcal L_X Y$:</p>
<ul>
<li>
<p>The Lie derivative is well-defined once a smooth structure for $M$ is specified, whereas the connection is an additional structure that is <em>imposed</em> on $M$; in particular, endowing $M$ with geometry uniquely specifies the Levi-Civita connection. Importantly, there is no <em>natural</em> choice of a connection on a smooth manifold until a metric is chosen for it</p>
</li>
<li>
<p>The Lie derivative $\mathcal L_X Y$ at $p\in M$ is defined via local flows/diffeomorphisms of $X$ near $p$, whereas $\nabla _X Y$ only depends on the vector $X_p \in T_p M$</p>
</li>
<li>
<p>$X \mapsto \mathcal L_X$ is only an $\mathbb R$-linear map (and therefore, not a tensor), whereas $X \mapsto \nabla_X$ is $C^\infty(M)$-linear<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. Neither of $\mathcal L_X(\hspace{1pt}\cdot\hspace{1pt})$ and $\nabla_X(\hspace{1pt}\cdot\hspace{1pt})$ is $C^\infty(M)$-linear</p>
</li>
<li>
<p>If $\nabla$ is torsion-free, then the torsion-free condition can be rearranged to yield</p>
</li>
</ul>
<p>
\[
    \nabla_ X Y = \big(\nabla X + \mathcal L_ X\big) Y
    \]
    </p>
The first of these is a $C^\infty(M)$-linear transformation of $Y$, so $\nabla _X$ can be viewed as an affine transformation, with $\mathcal L_X$ playing the role of translation. The presence of $\mathcal L_X$ destroys the linearity of $\nabla _X$, until and unless $X$ and $Y$ <i>commute</i>, in which case $\mathcal L_X Y = [X, Y] \equiv 0$.
<h2 id="tangential-connection">Tangential Connection<a hidden class="anchor" aria-hidden="true" href="#tangential-connection">#</a></h2>
<p>In general, the connection is given with respect to a smooth local frame $({E_i})_{i=1}^n$ on $U\subseteq M$ by $\nabla _{E_i} E_j = \Gamma_{ij}^k E_k$, where $\Gamma_{ij}^k$ are called the <span class=accented>Christoffel symbols</span> of the connection with respect to $(E_i)_{i=1}^n$, and Einstein summation is implied. The Christoffel symbols specify the action of $\nabla$ on arbitrary vector fields on $U$:</p>
<p>
\[
    \nabla_X Y = X(Y^i) E_i + Y^i \nabla_X E_i = \big(X(Y^k) + X^i Y^j \Gamma_{ij}^k \big)E_k
    \]
</p>
<p>where $Y = Y^i E_i$ is the expansion of $Y$ in the frame $(E_i)_{i=1}^n$.
The Christoffel symbols $\Gamma_{ij}^k$ of the Levi-Civita connection can be expressed using the <em>second Christoffel identity</em> (which relies on coordinates) or by using the <em>Koszul formula</em> (which is coordinate-free); see Corollary $5.11$ in Lee&rsquo;s book (on Riemannian manifolds).</p>
<aside class=aside-right>
Similar to how the Whitney embedding theorem allows us to embed $M$ in $\mathbb R^{2n},$ <a href=https://en.wikipedia.org/wiki/Nash_embedding_theorems class=accented>a theorem attributed to John Nash</a> says that any Riemannian manifold can be <i>isometrically</i> embedded in a higher-dimensional Euclidean space.
</aside>
<p>Sometimes, a more straightforward way to work with the Levi-Civita connection is to isometrically embed $M$ in a higher-dimensional Euclidean space, and then (in a sense) pull back the Euclidean connection to $M$. This is considered the <span class=accented>extrinsic approach</span> and comes at the risk of obscuring the intrinsic structure of $M$.
Let $\mathbb R^{\bar n}$ be the Euclidean $\bar n$-space having the Euclidean metric $\bar g$. Its Levi-Civita connection is given by</p>
<p>
\[
    \overline \nabla_X Y = X(Y^i) \frac{\partial}{\partial x^i}
    \]
</p>
<p>which is precisely how a naive calculus student would differentiate vector fields &ndash; the Riemannian geometer should be aware that this formula only holds because the Christoffel symbols are all $0$ in this case.</p>
<p>Now, let $\pi: T_p \mathbb R^{\bar n} \rightarrow T_p M$ be the orthogonal projection of tangent vectors of $\mathbb R^{\bar n}$ onto $T_p M$. Then, the Levi-Civita connection on $M$, denoted $\nabla$, is given by</p>
<p>
\[
    \nabla_X Y = \pi \left(\overline \nabla_{\overline  X} \overline  Y\right)
    \]
</p>
<p>where $\overline X$ and $\overline  Y$ are smooth extensions of $X$ and $Y$ to an open set of $\mathbb R^{\bar n}$, respectively. This paints an extrinsic picture of the covariant derivative: it is the rate of change of $Y$ along $X$ <em>as seen from within $M$</em>, i.e., changes in $Y$ that are normal to $M$ are disregarded.</p>
<hr>
<p>We are ready to attempt Problem $5-5$ from Lee&rsquo;s book.</p>
<h1 id="the-sphere">The Sphere<a hidden class="anchor" aria-hidden="true" href="#the-sphere">#</a></h1>
<p>A vector field $X$ is said to be a <em>parallel</em> vector field if $\nabla X$ is identically $0$. A (local) parallel coordinate frame (see <a href="/posts/lie-groups_calculus" class="accented">
    my other post
</a> for an introduction to coordinate frames) exists on (an open set of) a manifold $M$ if and only if $M$ is (locally) flat. Here, local (or global) flatness refers to the property of being locally (or globally) isometric to an open set of the Euclidean space of the same dimension.</p>
<p>A $2$-dimensional manifold is locally flat if and only if a small piece (i.e., an open set) cut out from it can be laid flat on the table without stretching, tearing, or crumpling it. The surface of a Cylinder and the Möbius strip (with a certain, natural choice of metric for it) are examples of locally flat surfaces; this is exactly why one can construct these surfaces from a piece of paper. The crux of Problem $5-5$ is to show that such a local parallel vector field does not exist on the sphere $S^2$. (This can be compared to the difficulty of drawing a map of the Earth that does not introduce distortions of some sort.)</p>
<p>First, Lee asks us to consider the following embedding of the $2$-sphere in $\mathbb R^3$:</p>
<p>
\[
    \begin{aligned}
        \psi: U &\rightarrow \mathbb R^3 \\
        (x^1, x^2) &\mapsto \left(\sin x^1 \cos x^2, \sin x^1 \sin x^2, \cos x^1\right)
    \end{aligned}
    \]
</p>
<p>where $U\subseteq S^2$ is an open set on the sphere and $(x^1, x^2)$ are the usual spherical polar coordinates on the sphere; technically, $\psi$ is the pullback of an embedding under the spherical polar parameterization:</p>
<figure class=invertible style="max-width: 100%;">
<img src=/post-images/differential_forms/sphere.png>
<figcaption>Embedding of the sphere in $\mathbb R^3$</figcaption>
</figure>
<p>In the illustration, we use a &lsquo;wobbly sphere&rsquo; to remind us that $S^2$ does not necessarily come endowed with geometry. Rather, by treating $\hat \psi$ as an isometry, we will &lsquo;pull back&rsquo; the geometry of $\mathbb R^3$ onto $S^2$.
To this end, consider the frame $\big(\frac{\partial}{\partial x^1}, \frac{\partial}{\partial x^2}\big)$ on $\mathbb R^2$<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>. We know that $\varphi ^{-1}$ pushes this forward, yielding the local coordinate frame $(\varphi ^{-1}_*\frac{\partial}{\partial x^1},\varphi ^{-1}_*\frac{\partial}{\partial x^2})$ on $S^2$.
It can then be pushed forward to $\mathbb R^3$, giving us</p>
<p>
\[
    \Big(\hat \psi_*\big(\varphi ^{-1}_*\frac{\partial}{\partial x^1}\big), \hat \psi_*\big(\varphi ^{-1}_*\frac{\partial}{\partial x^2} \big) \Big) = \Big(\psi_*\frac{\partial}{\partial x^1}, \psi_*\frac{\partial}{\partial x^2} \Big).
    \] 
</p>
<p>Denote the standard frame in $\mathbb R^3$ by $(\frac{\partial}{\partial y^1}, \frac{\partial}{\partial y^2}. \frac{\partial}{\partial y^3})$. We have (using the usual chain rule),</p>
<p>
\[
    \begin{aligned}
        X \coloneqq \psi_* \frac{\partial}{\partial x^1} &= \cos x^1 \cos x^2 \frac{\partial}{\partial y^1} + \cos x^1 \sin x^2 \frac{\partial}{\partial y^2} - \sin x^1 \frac{\partial}{\partial y^3},
        \\
        Y \coloneqq \psi_* \frac{\partial}{\partial x^2} &= -\sin x^1 \sin x^2 \frac{\partial}{\partial y^1} + \sin x^1 \cos x^2 \frac{\partial}{\partial y^2}.
    \end{aligned}
    \]
</p>
<p>So, there is a good reason for distinguishing between $(x^1, x^2)$ and $(y^1, y^2, y^3)$. The second of these vector fields is $Y = -y^2 \frac{\partial}{\partial y^1} + y^1 \frac{\partial}{\partial y^2}$, and the first is more complicated to write in terms of $(y^1, y^2, y^3)$.</p>
<h2 id="are-x-and-y-parallel">Are $X$ and $Y$ Parallel?<a hidden class="anchor" aria-hidden="true" href="#are-x-and-y-parallel">#</a></h2>
<p>If they are, then we will conclude that the sphere is flat.</p>
<p>Observe that $X$ are the longitudinal (i.e., vertical) vector fields on the sphere, and $Y$ are the latitudinal (i.e., horizontal) vector fields.
Lee asks us to compute $\nabla_{X} X$ and $\nabla_{Y} X$ to assess the parallel-ness of $X$, with $\nabla$ being the tangential connection. <!-- We use the tangential connection for this.  --> I tried this using the standard (Cartesian) coordinate frame of $\mathbb R^3$, but the computations are cumbersome. For instance, we have</p>
<p>
\[
\begin{align*}
\overline \nabla_{\overline Y} {\overline X} &= {\overline Y}({\overline X}^1) \frac{\partial}{\partial y^1} + {\overline Y}({\overline X}^2) \frac{\partial}{\partial y^2} + {\overline Y}({\overline X}^3) \frac{\partial}{\partial y^3}\\
&= \overline Y\left(\frac{y^3 y^1}{\sqrt{{y^1}^2 + {y^2}^2}}\right)\frac{\partial}{\partial y^1} + \overline Y\left(\frac{y^3 y^2}{\sqrt{{y^1}^2 + {y^2}^2}}\right)\frac{\partial}{\partial y^2} \\
&\qquad + \overline Y\left(-\sqrt{{y^1}^2 + {y^2}^2}\right)\frac{\partial}{\partial y^3}\\
&= \frac{-y^2 y^3}{\sqrt{{y^1}^2 + {y^2}^2}}\frac{\partial}{\partial y^1} + \frac{y^1 y^3}{\sqrt{{y^1}^2 + {y^2}^2}}\frac{\partial}{\partial y^2} 
\end{align*}
\]
</p>
<aside class=aside-center>
Here, I considered the map $(x^1,x^2) \mapsto (x^3 \sin x^1 \cos x^2, x^3 \sin x^1 \sin x^2, x^3 \cos x^1)$ in order to define extensions of $X$ and $Y$ to open sets of $\mathbb R^3$, yielding $\overline X$ and $\overline Y$, which is the first step in the computation of the tangential connection.
</aside>
<p>Even without projecting onto the sphere (recall the definition of a tangential connection), we see that $\overline \nabla_{\overline Y} {\overline X}$ is $0$ when $y^3=0$, meaning that $X$ is parallel along the equator of the sphere. The computation of $\overline \nabla_{\overline X} {\overline X}$ can also be done in this way, but it will be messy. Let&rsquo;s look for a better approach.</p>
<p>Before we get there, what do you think $\nabla _X X$ will turn out to be? Here&rsquo;s a hint: the integral curves of $X$ are said to be <span class=accented>geodesics</span> (locally length-minimizing paths) if and only if $X$ is parallel along its integral curves, i.e., $\nabla _X X = 0$. What are the geodesics of the sphere? You might know these as the paths that airplanes like to take when flying long distances.</p>
<h3 id="using-a-coordinate-frame">Using a Coordinate Frame<a hidden class="anchor" aria-hidden="true" href="#using-a-coordinate-frame">#</a></h3>
<p>The frame $\left(\frac{\partial}{\partial y_1}, \frac{\partial}{\partial y_2}, \frac{\partial}{\partial y_3}\right)$ is a global coordinate frame for $\mathbb R^3$ derived from the standard/trivial coordinates, $(y^1,y^2, y^3) \mapsto (y^1,y^2, y^3)$. It is attractive to us because it is orthonormal (the metric tensor coefficients are $\delta_{ij}$, making the metric reduce to a dot product), and the Christoffel symbols $\lbrace\Gamma_{ij}^k\rbrace_{i,j,k=1}^3$ of the Levi-Civita connection $\overline \nabla$ are all identically $0$.</p>
<p>Let&rsquo;s construct a different coordinate frame for $\mathbb R^3$. We consider the spherical polar parametrization of $\mathbb R^3$, $(\varphi, \theta, r) \mapsto (r \sin \varphi \cos \theta, r \sin \varphi \sin \theta, r \cos \varphi)$. This induces a coordinate frame $(\partial_\varphi, \partial_\theta, \partial_r)$ with $\partial_\varphi\vert_{r=1}=X$ and $\partial_\theta\vert_{r=1}=Y$; the vertical line &lsquo;$\vert$&rsquo; is read as &lsquo;restricted to&rsquo;. This frame is not defined along the $y^3$ axis, but that&rsquo;s okay &ndash; it is a <em>local</em> coordinate frame.</p>
<p>It seems as if this should simplify the calculation greatly, so (by an application of the <a href="https://en.wikipedia.org/wiki/No_free_lunch_theorem" target="_blank" class="accented">
    no free lunch theorem
</a>) there must be a catch. The catch is that the frame $(\partial_\varphi, \partial_\theta, \partial_r)$ is not orthonormal, so we need to compute the Christoffel symbols of the Levi-Civita connection with respect to this frame. (Chapter 7 of Lee shows that a local orthonormal coordinate frame can exist if and only if the manifold is locally flat; this is yet another way of demonstrating the non-flatness of the sphere.)</p>
<p>Let&rsquo;s look at the metric tensor coefficients $g_{ij}$. We have, $g_{11}=\langle \partial_\varphi, \partial_\varphi \rangle$, with</p>
<p>
\[
\begin{align}
 \partial_\varphi &= r \cos \varphi \cos \theta \frac{\partial}{\partial y^1} + r \cos \varphi \sin \theta \frac{\partial}{\partial y^2} - r \sin \varphi \frac{\partial}{\partial y^3}\\
\partial_\theta &= -r \sin \varphi \sin \theta \frac{\partial}{\partial y^1} + r \sin \varphi \cos \theta \frac{\partial}{\partial y^2}\\
\partial_r &= \sin \varphi \cos \theta \frac{\partial}{\partial y^1} + \sin \varphi \sin \theta \frac{\partial}{\partial y^2} + \cos \varphi \frac{\partial}{\partial y^3}
\end{align}
\]
</p>
<p>so that $g_{11}(\varphi, \theta, r) = r^2$. Completing the metric tensor, we find that $g_{22}(\varphi, \theta, r) = r^2 \sin^2 \varphi$ and $g_{33}(\varphi, \theta, r) = 1$. Amazingly (but as expected), $g_{12}$, $g_{13}$, $g_{23}$, and their symmetric counterparts are all identically $0$.<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> The Christoffel symbols in a coordinate frame are given by the formula</p>
<p>
\[
\begin{align}
\Gamma_{ij}^k &= \frac{1}{2} g^{kl} \left(
    \partial_i g_{jl} + \partial_j g_{il} - \partial_l g_{ij}
    \right)
\end{align}
\]
</p>
<p>where $g^{ij}$ are coefficients of the inverse of the metric tensor (see p. 123 of Lee). So, we have</p>
<p>
\[
\begin{align}
\Gamma_{11}^3 = -r, \quad \Gamma_{12}^2=\frac{\cos \varphi}{\sin \varphi}, \quad \Gamma_{13}^1 = \frac{1}{r}.
\end{align}
\]
<p>giving us</p>
<p>
\[
\begin{align}
\overline \nabla_{\overline X} \overline X &= \overline \nabla_{\partial_\varphi} \partial_\varphi \\
&= \overline \nabla_{\partial_1} \partial_1  =\Gamma_{11}^3 \partial_3 = -r \partial_r
\end{align}
\]
</p>
<p>Since $\overline \nabla_{\overline X} \overline X$ is purely in the radial direction, we have that $\nabla _X X = \pi \left(\overline \nabla_{\overline X} \overline X\right) =0$. Thus, $X$ is indeed parallel along its own integral curves; the integral curves of $X$ are segments of the geodesics (i.e., great circles) passing through the poles.</p>
<p>Lastly, we compute $\nabla _Y X$ in the new frame:</p>
<p>
\[
\begin{align}
\overline \nabla_{\overline Y} \overline X &= \overline \nabla_{\partial_\theta} \partial_\varphi \\
&= \overline \nabla_{\partial_2} \partial_1 = \Gamma_{21}^2 \partial_2 = \frac{\cos \varphi}{\sin \varphi} \partial_\theta\\
\Rightarrow   \nabla_{Y} X &= \pi \left( \overline \nabla_{\overline Y} \overline X\right )=\frac{\cos \varphi}{\sin \varphi} \partial_\theta
\end{align}
\]
</p>
<p>(since $\Gamma_{21}^2=\Gamma_{12}^2$ for the Levi-Civita connection). As we deduced before, $X$ is only parallel in the horizontal/latitudinal directions if $\cos \varphi =0$, i.e., at the equator. In conclusion, $\nabla X \neq 0$.</p>
<h3 id="could-there-be-another-parallel-frame">Could there be another parallel frame?<a hidden class="anchor" aria-hidden="true" href="#could-there-be-another-parallel-frame">#</a></h3>
<p>We have only shown that $(X,Y)$ is not a parallel frame, which does not preclude the existence of another parallel coordinate frame.  Lee asks us to consider the point $(y^1, y^2, y^3)=(1,0,0)$ in $\mathbb R^3$, and show that there is no parallel coordinate frame near this point. By symmetry, the argument would extend to other points on the sphere. I omit the arguments here, but page $194$ of Lee&rsquo;s book outlines the process of constructing a parallel frame near $p=(1,0,0)$. The key idea is that such an attempt to construct a parallel vector field would both (i) coincide with $X$, and (ii) fail to be parallel.</p>
<aside class=aside-center>
The insistence of the frame being a <i>coordinate frame</i> (i.e., pushforwards of coordinate vector fields) is crucial. There may exist local orthonormal frames on non-flat manifolds that are orthonormal or parallel but are not coordinate frames. See the last section of this post for further discussion.
</aside>
<hr>
<h2 id="some-stronger-claims">Some Stronger Claims<a hidden class="anchor" aria-hidden="true" href="#some-stronger-claims">#</a></h2>
<p>In the above, we worked with a specific isometric embedding of the sphere in $\mathbb R^3$, restricting our investigation to a specific choice of a metric. Could another metric be prescribed for the sphere that makes it flat (or equivalently, enables us to prescribe a local orthonormal/parallel coordinate frame)? Firstly, we belabor the point that flatness is dependent on the metric at all.</p>
<p><strong>The non-flat torus:</strong>  The 2-torus $\mathbb T^2 \cong S^1 \times S^1$ can be embedded in $\mathbb R^3$ as a donut: this is not flat, because parallel transport of a vector from inside the hole (i.e., close to the axis) of the donut to the outside (i.e., far from the axis) would need to preserve its length, posing an obstacle to the construction of a parallel coordinate frame. Equivalently, one cannot wrap a piece of paper around a donut (unless the length or width of the piece of paper were vanishingly small) without introducing creases or folds in the paper.</p>
<p><strong>The flat torus:</strong> At the same time, the 2-torus can be embedded in $\mathbb R^4$ (analogous to how a circle can be embedded in $R^2$<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>)
or realized as the quotient manifold $\mathbb R^2/\mathbb Z^2$. The latter two constructions would give rise to natural choices of flat metrics. We conclude that $\mathbb T^2$ admits a flat metric, but the donut (which is $\mathbb T^2$ with a specific choice of metric) is not flat. That being said, it <em>is</em> possible to isometrically embed the flat torus in $\mathbb R^3$; <a href="http://hevea-project.fr/ENPageToreDossierDePresse.html" target="_blank" class="accented">
    these researchers
</a> are working on visualizing such an embedding, and observe that it has a self-similar, fractal-like structure, indicating that the situation is much more subtle than our naive conception of the donut.</p>
<!-- [^nash]: The Nash-Kuiper embedding theorem is deemed to be counterintuitive and (according to Wikipedia). we are only guaranteed that we can *approximately* embed a smooth manifold in a higher-dimensional Euclidean space, though the degree of approximation can be arbitrarily good. -->
<p><strong>The locally flat sphere</strong>: The sphere <em>does</em> admits a metric that is locally flat (near a given point, $p\in \mathbb S^2$). To see this, we take a cube in $\mathbb R^3$ and smooth all of its edges and corners (to make it smooth); this smoothed cube is now a smooth embedding of the sphere in $\mathbb R^3$, and its pullback metric is certainly (locally) flat near some of the points. So, a more appropriate question to ask is whether the sphere can be <em>globally flat</em>, i.e., does it admit a metric that is flat in every neighborhood, even near the &rsquo;edges&rsquo; of the smoothed cube?</p>
<p><strong>The (non-existence of a) globally flat sphere:</strong> Surprisingly, the answers to such questions come from algebraic geometry, having their roots in combinatorics (i.e., counting arguments). The Euler characteristic of the sphere, combined with the Gauss-Bonnet theorem can be used to show that the sphere does not admit a globally flat metric. Here&rsquo;s another proof that relies on a theorem that may be familiar (or at least accessible) to most readers. Let $(S^2, g)$ be a hypothesized flat metric on the sphere. There exists then, a global parallel vector field $X$.
By metric compatibility of the corresponding Levi-Civita connection, we have</p>
<p>
\[
\nabla_Y \langle X,X \rangle = \langle \nabla_Y X, X \rangle + \langle  X, \nabla_Y X \rangle = 0
\]
</p>
<p>This means that if $\langle X, X\rangle _p \neq 0$ at some point $p$, then $\langle X, X\rangle$ (and therefore, $X$) does not vanish anywhere on $S^2$. The <a href="https://en.wikipedia.org/wiki/Hairy_ball_theorem" target="_blank" class="accented">
    hairy ball theorem
</a> says that this is impossible &ndash; a contradiction.</p>
<hr>
<h2 id="a-word-of-caution">A Word of Caution!<a hidden class="anchor" aria-hidden="true" href="#a-word-of-caution">#</a></h2>
<p>The most confusing part of self-learning Riemannian geometry has been, for me, the conflation between frames and coordinate frames. I suggest that the reader familiarizes theirself with the definition of either (a coordinate chart induces a frame, but not every frame is the frame derived from a coordinate chart). Every time you encounter a formula, statement, or theorem, take care to check whether it only holds for a coordinate frame.</p>
<p>The following examples show why this distinction is important:</p>
<ul>
<li>
<p>The left-invariant vector fields $(E_i)_{i=1}^n$ of a Lie group form a global, orthonormal (after carrying out the Gram-Schmidt process) frame. Does this mean that every Lie group is globally flat? No, because the frame of left-invariant vector fields on a non-Abelian Lie group is not a coordinate frame. To see this, observe that $[E_i, E_j] \neq 0$ whereas the Lie brackets must vanish in a coordinate frame (since the partial derivative operators of $\mathbb R^n$ commute).<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup></p>
</li>
<li>
<p>For the same reason, it is seldom possible to choose an orthonormal coordinate frame. One either gives up orthonormality (choosing to introduce a metric tensor) or gives up the coordinate frame (choosing to work with a frame that is not a coordinate frame, such as $(E_i)_{i=1}^n$).</p>
</li>
<li>
<p>The Christoffel symbols of the Levi-Civita connection are symmetric in the lower indices ($\Gamma_{ij}^k = \Gamma_{ji}^k$), but this is only true in a coordinate frame.</p>
</li>
<li>
<p>The identity we used to compute the Christoffel symbols in this post only holds in a coordinate frame. In a non-coordinate frame, we would replace it with the appropriate formula in Corollary 5.11 of Lee&rsquo;s book.</p>
</li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>The metric compatibility condition is equivalent to the condition that $\nabla g \equiv 0$, though to define what this even means, we need to understand how the connection on $TM$ induces a connection on symmetric $(0,2)$-tensors on $M$ (of which the metric tensor $g$ is an example).&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Note that $\mathcal L_{fX} Y = [fX,Y] = -\mathcal L_Y (fX)$, so the Lie derivative satisfies a Leibniz/product rule in either of its arguments.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>This frame looks like a net/mesh on $\mathbb R^2$ but gets warped when it&rsquo;s pushed forward to $S^2$.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>I find it remarkable that this frame is orthogonal but not ortho<em>normal</em> (and moreover, not constant), and that in itself is enough to pose an obstruction to flatness.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>Note that $S^1$ (and in fact, all one-dimensional smooth manifolds) is flat independently of the choice of metric; a piece of string/yarn can always be curved into another shape of desire. Consequently, the product metric on $S^1\times S^1$ is flat as well.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>The left-invariant vector fields do <em>induce</em> coordinates on a connected Lie group, called the exponential coordinates: $(x^1, \cdots, x^n) \mapsto \exp \left(\sum_{i=1}^n x^i (E_i)_e\right)$. However, even for the matrix exponential, the sum inside $\exp$ splits into a product of $\exp$s only when $(E_1, \cdots, E_n)$ commute with each other, i.e., when their pairwise Lie brackets vanish.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
<script src="https://giscus.app/client.js"
        data-repo="shirazkn/shirazkn.github.io"
        data-repo-id="R_kgDOI2VbWw"
        data-category="Announcements"
        data-category-id="DIC_kwDOI2VbW84CWJnt"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
    
    <div class="signup-form">
        <script async src="https://eocampaign1.com/form/e5dbf9e6-b891-11ee-a1b7-cdaf9e8a98be.js" data-form="e5dbf9e6-b891-11ee-a1b7-cdaf9e8a98be"></script>
    </div>
    
    
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div class="headerfooter">
    <sub><sup><sub>&#9786;</sub></sup></sub>
</div>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
