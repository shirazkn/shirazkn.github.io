<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head>
	<meta name="generator" content="Hugo 0.154.5"><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Shiraz</title>

<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="https://shirazkn.github.io/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b78659d76588cf580b3b8c681621f1110b38b5c6048b3adb139c26417d83bf35.css" integrity="sha256-t4ZZ12WIz1gLO4xoFiHxEQs4tcYEizrbE5wmQX2DvzU=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://shirazkn.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://shirazkn.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://shirazkn.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://shirazkn.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://shirazkn.github.io/favicon.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://shirazkn.github.io/index.xml" title="rss">
<link rel="alternate" type="application/json" href="https://shirazkn.github.io/index.json" title="json">
<link rel="alternate" hreflang="en" href="https://shirazkn.github.io/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><script>
(function() {
    var pref = localStorage.getItem("pref-theme");
    if (pref === "dark" || (!pref && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
        document.documentElement.classList.add("dark");
    }
})();
</script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      packages: {'[+]': ['mathtools', 'amscd']},
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']]  
    },
    loader:{
      load: ['ui/safe', '[tex]/mathtools', '[tex]/amscd']
    },
  };
</script>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IM+Fell+DW+Pica">

<meta property="og:url" content="https://shirazkn.github.io/">
  <meta property="og:site_name" content="Shiraz">
  <meta property="og:title" content="Shiraz">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shiraz">
<meta name="twitter:description" content="">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Shiraz",
  "url": "https://shirazkn.github.io/",
  "description": "",
  "logo": "https://shirazkn.github.io/favicon.ico",
  "sameAs": [
      "https://www.github.com/shirazkn", "https://www.linkedin.com/in/shiraz-k/"
  ]
}
</script>
</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://shirazkn.github.io/" accesskey="h" title="Shiraz (Alt + H)">Shiraz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://shirazkn.github.io/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="https://shirazkn.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://shirazkn.github.io/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 

<article class="post-entry"> 
  <div class="entry-bg" style="background-image: url('/post-images/differential_forms/section.png');"></div>
  <header class="entry-header">
    <h2>Vector Fields on Manifolds
    </h2>
  </header>
  <div class="entry-content">
    <p>Over the past year, I have struggled to pin down what the scope of my blog should be. Maybe it is for me to catalog the process of self-learning mathematics as an engineering major who lacks a curricular background in modern mathematics. This post serves in part the purpose of organizing my own thoughts on these matters, and in part the purpose of providing a roadmap for others who are interested in embarking on a similar journey.</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-03 11:22:28 -0500 EST'>January 3, 2024</span></footer>
  <a class="entry-link" aria-label="post link to Vector Fields on Manifolds" href="https://shirazkn.github.io/posts/vector-fields/"></a>
</article>

<article class="post-entry"> 
  <div class="entry-bg" style="background-image: url('/post-images/fourier/periodic.png');"></div>
  <header class="entry-header">
    <h2>Fourier Transforms of Periodic Functions
    </h2>
  </header>
  <div class="entry-content">
    <p>The Fourier transform takes a function and outputs a different (possibly complex-valued) function. We also have something called the Fourier series, which takes a periodic function and gives a summation rather than an integral. I want to derive the Fourier series using the Fourier transform for anyone who is interested in connecting the two concepts with each other.</p>
  </div>
  <footer class="entry-footer"><span title='2023-10-02 14:59:15 -0400 EDT'>October 2, 2023</span></footer>
  <a class="entry-link" aria-label="post link to Fourier Transforms of Periodic Functions" href="https://shirazkn.github.io/posts/fourier/"></a>
</article>

<article class="post-entry"> 
  <div class="entry-bg" style="background-image: url('/post-images/linear_algebra/linear_tfm.png');"></div>
  <header class="entry-header">
    <h2>Matrix Multiplication
    </h2>
  </header>
  <div class="entry-content">
    <p>In this post I want to bridge the gap between abstract vector spaces (which are the mathematical foundation of linear algebra) and matrix multiplication (which is the linear algebra most of us are familiar with). Unlike the typical 101 course in linear algebra, I will avoid talking about solving systems of equations.</p>
  </div>
  <footer class="entry-footer"><span title='2023-05-28 10:35:07 -0400 EDT'>May 28, 2023</span></footer>
  <a class="entry-link" aria-label="post link to Matrix Multiplication" href="https://shirazkn.github.io/posts/matrix/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>What is a Vector?
    </h2>
  </header>
  <div class="entry-content">
    <p>A running gag in engineering colleges is that a lot of instructors begin their first class of the semester with this question – “What is a vector?”. I used to find this ritual almost pointless because every answer felt either like a non-answer or a matter of context. Today, I no longer think that this is a matter of context.</p>
  </div>
  <footer class="entry-footer"><span title='2023-05-20 15:26:18 -0700 -0700'>May 20, 2023</span></footer>
  <a class="entry-link" aria-label="post link to What is a Vector?" href="https://shirazkn.github.io/posts/vector/"></a>
</article>

<article class="post-entry"> 
  <div class="entry-bg" style="background-image: url('/post-images/optimization/L1Norm.png');"></div>
  <header class="entry-header">
    <h2>Understanding Sparsity through Sub-Gradients
    </h2>
  </header>
  <div class="entry-content">
    <p>We talked about why sparsity plays an important role in many of the inverse problems that we encounter in engineering. To actually find the sparse solutions to these problems, we add ‘sparsity-promoting’ terms to our optimization problems; the machine learning community calls this approach regularization.</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-28 17:15:26 -0400 EDT'>April 28, 2023</span></footer>
  <a class="entry-link" aria-label="post link to Understanding Sparsity through Sub-Gradients" href="https://shirazkn.github.io/posts/sparsity_2/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>Sparsity
    </h2>
  </header>
  <div class="entry-content">
    <p>The so called curse of dimensionality in machine learning is the observation that neural networks with many parameters can be impossibly difficult to train due to the vastness of its parameter space. This is because many (if not all) of the problems we’re interested in solving as engineers have some inherent sparsity.</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-22 11:05:58 -0400 EDT'>April 22, 2023</span></footer>
  <a class="entry-link" aria-label="post link to Sparsity" href="https://shirazkn.github.io/posts/sparsity/"></a>
</article>

<article class="post-entry"> 
  <div class="entry-bg" style="background-image: url('/post-images/linear_algebra/projection.png');"></div>
  <header class="entry-header">
    <h2>Hilbert Spaces
    </h2>
  </header>
  <div class="entry-content">
    <p>A Hilbert space is a vector space that has an inner product and that it is complete, i.e., it doesn’t have holes in it. Inner product spaces have a rich geometric structure, and so do Hilbert spaces. The Euclidean space is an obvious example, where the inner product is just the dot product.</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-21 12:09:09 -0400 EDT'>April 21, 2023</span></footer>
  <a class="entry-link" aria-label="post link to Hilbert Spaces" href="https://shirazkn.github.io/posts/hilbert-spaces/"></a>
</article>

<article class="post-entry"> 
  <div class="entry-bg" style="background-image: url('/post-images/linear_algebra/sphere_in_cube.png');"></div>
  <header class="entry-header">
    <h2>Norm Balls
    </h2>
  </header>
  <div class="entry-content">
    <p>Let’s look at the norm balls corresponding to the different p-norms. When p equals 2 this is the usual Euclidean distance. The corresponding ball is what we think of when someone says ‘ball’, it is all the points that are within a given distance from the origin.</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-18 21:32:10 -0400 EDT'>April 18, 2023</span></footer>
  <a class="entry-link" aria-label="post link to Norm Balls" href="https://shirazkn.github.io/posts/balls/"></a>
</article>

<article class="post-entry"> 
  <div class="entry-bg" style="background-image: url('/post-images/linear_algebra/parallelogram_1.png');"></div>
  <header class="entry-header">
    <h2>The Parallelogram Law
    </h2>
  </header>
  <div class="entry-content">
    <p>I mentioned in the last post that Euclidean geometry arises by taking the real numbers and endowing with an inner product, at which point it satisfies the Pythagoras theorem. In this post I will talk about how the Pythagoras theorem is a special case of a more general feature of inner product spaces.</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-14 15:53:46 -0400 EDT'>April 14, 2023</span></footer>
  <a class="entry-link" aria-label="post link to The Parallelogram Law" href="https://shirazkn.github.io/posts/pythagoras/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>Norms, Metrics, and Inner Products
    </h2>
  </header>
  <div class="entry-content">
    <p>An explainer on norms, metrics, and inner products, and their relationships to each other.</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-10 12:20:23 -0400 EDT'>April 10, 2023</span></footer>
  <a class="entry-link" aria-label="post link to Norms, Metrics, and Inner Products" href="https://shirazkn.github.io/posts/norms_metrics/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="https://shirazkn.github.io/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="https://shirazkn.github.io/page/3/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
    
    
    
    
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script>

document.addEventListener('touchstart', function() {}, { passive: true });


function syncDarkClass() {
    const isDark = document.documentElement.dataset.theme === 'dark';
    document.documentElement.classList.toggle('dark', isDark);
    document.body.classList.toggle('dark', isDark);
}
syncDarkClass();


const themeToggle = document.getElementById('theme-toggle');
if (themeToggle) {
    themeToggle.addEventListener('click', () => {
        setTimeout(syncDarkClass, 0);
    });
}


document.querySelectorAll('.logo a, .post-title').forEach(el => {
    el.innerHTML = el.textContent.trim().split(' ').map(word =>
        `<span class="hover-word">${word.split('').map(char =>
            `<span class="hover-letter">${char}</span>`
        ).join('')}</span>`
    ).join(' ');
});


const isDark = () => document.body.classList.contains('dark');
const hoverColorsDark = ['#ff51af', '#ff51af', '#f161ac', '#f161ac', '#db327e', '#db327e', '#3b82f6', '#38bdf8'];
const hoverColorsLight = ['#ff51af', '#ff51af', '#e83a89', '#e83a89', '#f542a1', '#d6306f', '#3b9eff', '#00c2ff'];
const getHoverColors = () => isDark() ? hoverColorsDark : hoverColorsLight;
document.querySelectorAll('.hover-letter').forEach(letter => {
    letter.addEventListener('mouseenter', () => {
        const colors = getHoverColors();
        letter.style.color = colors[Math.floor(Math.random() * colors.length)];
    });
    letter.addEventListener('mouseleave', () => {
        letter.style.color = '';
    });
});


let scanInProgress = false;
const scanElement = (el) => {
    if (scanInProgress) return;
    scanInProgress = true;
    const letters = el.querySelectorAll('.hover-letter');
    const colors = getHoverColors();
    const totalTime = letters.length * 50 + 100;
    letters.forEach((letter, i) => {
        setTimeout(() => {
            letter.style.transition = 'top 0.05s ease-out, color 0s';
            letter.style.color = colors[Math.floor(Math.random() * colors.length)];
            letter.style.top = '-0.08em';
            setTimeout(() => {
                letter.style.transition = '';
                letter.style.color = '';
                letter.style.top = '';
            }, 100);
        }, i * 50);
    });
    setTimeout(() => { scanInProgress = false; }, totalTime);
};

let lastScannedEl = null;
const triggerRandomScan = () => {
    const logos = Array.from(document.querySelectorAll('.logo a'));
    const titles = Array.from(document.querySelectorAll('.post-title'));
    
    const pickLogo = Math.random() < 0.5 && logos.length > 0;
    let elements = pickLogo ? logos : titles;
    
    if (lastScannedEl && elements.length > 1) {
        elements = elements.filter(el => el !== lastScannedEl);
    }
    if (elements.length > 0) {
        const el = elements[Math.floor(Math.random() * elements.length)];
        lastScannedEl = el;
        scanElement(el);
    }
    
    setTimeout(triggerRandomScan, 4000 + Math.random() * 6000);
};


const isHomePage = document.querySelector('.first-entry.home-info') !== null;





const CARD_CONFIG = {
    
    hoverLift: 4,
    
    maxRotation: 0.8,
    
    shadowOpacityLight: 0.22,      
    shadowOpacityDark: 0.45,       
    shadowOpacityRange: 0.12,      
    
    shadowBlurBase: 1.5,           
    shadowBlurHover: 2.5,          
    shadowYOffsetBase: 1,          
    shadowYOffsetHover: 2,         
};



const postCards = document.querySelectorAll('.post-entry');
const isTouchDevice = window.matchMedia('(pointer: coarse)').matches;

if (isTouchDevice && window.isSecureContext && 'DeviceOrientationEvent' in window) {
    
    
    let gyroBaselineBeta = null;
    let gyroBaselineGamma = null;
    const GYRO_DRIFT_RATE_MIN = 0.0008;  
    const GYRO_DRIFT_RATE_MAX = 0.25;   
    let gyroRafId = null;
    let latestBeta = null, latestGamma = null;
    let cardGyroPermissionRequested = false;

    
    let currentRotateX = 0, currentRotateY = 0;
    let currentTranslateX = 0, currentTranslateY = 0;

    
    let cardFocusValues = new Array(postCards.length).fill(0);
    let transformRafId = null;

    
    function scheduleTransformUpdate() {
        if (transformRafId) return;
        transformRafId = requestAnimationFrame(() => {
            applyCardTransforms();
            transformRafId = null;
        });
    }

    
    const observerThresholds = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0];
    const cardObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const index = Array.prototype.indexOf.call(postCards, entry.target);
            if (index === -1) return;

            
            const ratio = entry.intersectionRatio;
            
            cardFocusValues[index] = ratio * ratio;
        });
        scheduleTransformUpdate();
    }, {
        threshold: observerThresholds,
        
        rootMargin: '-15% 0px -15% 0px'
    });

    
    postCards.forEach(card => cardObserver.observe(card));

    function applyCardTransforms() {
        
        const baseGyroX = currentRotateX * 0.3;
        const baseGyroY = currentRotateY * 0.3;
        const gyroRangeX = currentRotateX * 0.7;
        const gyroRangeY = currentRotateY * 0.7;
        
        const baseTransX = currentTranslateX * 0.3;
        const baseTransY = currentTranslateY * 0.3;
        const transRangeX = currentTranslateX * 0.7;
        const transRangeY = currentTranslateY * 0.7;

        for (let i = 0; i < postCards.length; i++) {
            const focus = cardFocusValues[i];
            const card = postCards[i];

            
            const rotX = baseGyroX + gyroRangeX * focus;
            const rotY = baseGyroY + gyroRangeY * focus;
            const transX = baseTransX + transRangeX * focus;
            const transY = baseTransY + transRangeY * focus;

            card.style.transform = `perspective(1000px) rotateX(${rotX}deg) rotateY(${rotY}deg) translateX(${transX}px) translateY(${transY}px) scale(${1 + focus * 0.02})`;
            card.style.boxShadow = `0 ${1 + focus * 2}px ${2 + focus * 4}px rgba(0,0,0,${0.3 + focus * 0.3})`;
            card.style.opacity = 0.25 + focus * 0.75;
        }
    }

    function handleCardOrientation(event) {
        if (event.beta === null || event.gamma === null) return;

        
        const orientation = screen.orientation?.angle ?? window.orientation ?? 0;
        let beta, gamma;

        if (orientation === 90) {
            beta = event.gamma;
            gamma = -event.beta;
        } else if (orientation === -90 || orientation === 270) {
            beta = -event.gamma;
            gamma = event.beta;
        } else if (orientation === 180) {
            beta = -event.beta;
            gamma = -event.gamma;
        } else {
            beta = event.beta;
            gamma = event.gamma;
        }

        latestBeta = beta;
        latestGamma = gamma;

        if (!gyroRafId) {
            gyroRafId = requestAnimationFrame(() => {
                
                if (gyroBaselineBeta === null) {
                    gyroBaselineBeta = latestBeta;
                    gyroBaselineGamma = latestGamma;
                }

                
                const relativeBeta = latestBeta - gyroBaselineBeta;
                const relativeGamma = latestGamma - gyroBaselineGamma;

                
                const maxTilt = Math.max(Math.abs(relativeBeta), Math.abs(relativeGamma));
                const tiltFactor = Math.min(1, maxTilt / 30);  
                
                const driftRate = GYRO_DRIFT_RATE_MIN + tiltFactor * tiltFactor * tiltFactor * (GYRO_DRIFT_RATE_MAX - GYRO_DRIFT_RATE_MIN);

                
                gyroBaselineBeta += (latestBeta - gyroBaselineBeta) * driftRate;
                gyroBaselineGamma += (latestGamma - gyroBaselineGamma) * driftRate;

                
                currentRotateY = Math.max(-6, Math.min(6, relativeGamma * 0.25));
                currentRotateX = Math.max(-6, Math.min(6, relativeBeta * -0.25));

                
                currentTranslateX = Math.max(-4, Math.min(4, relativeGamma * 0.16));
                currentTranslateY = Math.max(-3, Math.min(3, relativeBeta * 0.14));

                scheduleTransformUpdate();
                gyroRafId = null;
            });
        }
    }

    function enableCardGyroscope() {
        window.addEventListener('deviceorientation', handleCardOrientation, { passive: true });
    }

    
    applyCardTransforms();

    
    postCards.forEach((card, index) => {
        let touchStartTime = 0;

        card.addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
            const focus = cardFocusValues[index];
            
            card.style.transition = 'transform 0.08s ease-out, box-shadow 0.08s ease-out';
            card.style.transform = `perspective(1000px) rotateX(0deg) rotateY(0deg) scale(${0.97 + focus * 0.01})`;
            card.style.boxShadow = `0 0.5px 1px rgba(0,0,0,0.2)`;
        }, { passive: true });

        card.addEventListener('touchend', () => {
            
            card.style.transition = 'transform 0.15s ease-out, box-shadow 0.15s ease-out';
            setTimeout(() => {
                card.style.transition = '';
                scheduleTransformUpdate();
            }, 150);
        }, { passive: true });

        card.addEventListener('touchcancel', () => {
            card.style.transition = '';
            scheduleTransformUpdate();
        }, { passive: true });
    });

    
    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        
        enableCardGyroscope();

        
        const requestPermission = () => {
            if (cardGyroPermissionRequested) return;
            cardGyroPermissionRequested = true;

            DeviceOrientationEvent.requestPermission()
                .then(state => {
                    if (state === 'granted') {
                        enableCardGyroscope();
                    }
                })
                .catch(() => {
                    cardGyroPermissionRequested = false;
                });
        };
        document.addEventListener('touchstart', requestPermission, { once: true, passive: true });
        document.addEventListener('touchend', requestPermission, { once: true, passive: true });
        document.addEventListener('click', requestPermission, { once: true, passive: true });
    } else {
        
        enableCardGyroscope();
    }
} else {
    
    
    let currentMouseCard = null;
    let lastMouseX = 0, lastMouseY = 0;

    postCards.forEach(card => {
        let rafId = null;
        let isPressed = false;

        card.addEventListener('mouseenter', () => {
            currentMouseCard = card;
        });

        card.addEventListener('mousemove', (e) => {
            if (isPressed) return; 
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;

            if (!rafId) {
                rafId = requestAnimationFrame(() => {
                    if (isPressed) { rafId = null; return; }
                    const rect = card.getBoundingClientRect();
                    const mouseX = lastMouseX - rect.left;
                    const mouseY = lastMouseY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = (mouseY - centerY) / centerY * -CARD_CONFIG.maxRotation;
                    const rotateY = (mouseX - centerX) / centerX * CARD_CONFIG.maxRotation;
                    const normalizedY = (centerY - mouseY) / centerY;
                    const isDarkMode = document.body.classList.contains('dark');
                    const baseOpacity = isDarkMode ? CARD_CONFIG.shadowOpacityDark : CARD_CONFIG.shadowOpacityLight;
                    const shadowOpacity = Math.max(0, baseOpacity + normalizedY * CARD_CONFIG.shadowOpacityRange);
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(${CARD_CONFIG.hoverLift}px)`;
                    card.style.boxShadow = `0 ${CARD_CONFIG.shadowYOffsetHover}px ${CARD_CONFIG.shadowBlurHover}px rgba(0, 0, 0, ${shadowOpacity})`;
                    rafId = null;
                });
            }
        });

        card.addEventListener('mousedown', () => {
            isPressed = true;
            card.style.transform = 'scale(0.99)';
            card.style.boxShadow = '';
        });

        card.addEventListener('mouseup', () => {
            isPressed = false;
        });

        card.addEventListener('mouseleave', () => {
            if (rafId) {
                cancelAnimationFrame(rafId);
                rafId = null;
            }
            isPressed = false;
            card.style.transform = '';
            card.style.boxShadow = '';
            currentMouseCard = null;
        });
    });

}

if (isHomePage) {
    
    setTimeout(triggerRandomScan, 3000 + Math.random() * 2000);
} else {
    
    setTimeout(() => {
        const logo = document.querySelector('.logo a');
        if (logo) scanElement(logo);

        setTimeout(() => {
            const titles = Array.from(document.querySelectorAll('.post-title'));
            if (titles.length > 0) {
                scanElement(titles[Math.floor(Math.random() * titles.length)]);
            }
            
            setTimeout(triggerRandomScan, 4000 + Math.random() * 6000);
        }, 400);
    }, 800);
}


const tocBox = document.querySelector('.toc');
if (tocBox) {
    const tocDetails = tocBox.querySelector('details');
    if (tocDetails) {
        tocBox.addEventListener('click', (e) => {
            
            if (e.target.tagName === 'A') return;
            
            if (e.target.closest('summary')) return;
            tocDetails.open = !tocDetails.open;
        });
    }
}
</script>
<div class="headerfooter">
    <sub><sup><sub>..</sub></sup></sub>
</div>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            document.documentElement.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            document.documentElement.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
